# üìä –§–ò–ù–ê–õ–¨–ù–´–ô –ê–£–î–ò–¢ –ü–ê–ú–Ø–¢–ò ESP32-S3

**–î–∞—Ç–∞:** 16 –æ–∫—Ç—è–±—Ä—è 2025  
**–ü—Ä–æ–µ–∫—Ç:** Hydro System 1.0  
**–ß–∏–ø:** ESP32-S3 (328 KB DRAM, 8 MB PSRAM)

---

## üéØ –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï –ü–ê–ú–Ø–¢–ò

### ESP32-S3 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–∞–º—è—Ç–∏:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –í–ù–£–¢–†–ï–ù–ù–Ø–Ø DRAM (Internal SRAM): 328 KB                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  .dram0.data (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ):     15.4 KB           ‚îÇ
‚îÇ  .dram0.bss (–Ω–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ):   146.0 KB           ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ           ‚îÇ
‚îÇ  –ò–¢–û–ì–û –°–¢–ê–¢–ò–ö–ê:                       161.4 KB           ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ  –î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è heap:                   182 KB             ‚îÇ
‚îÇ  (3 —Ä–µ–≥–∏–æ–Ω–∞: 129 KB + 21 KB + 32 KB)                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –í–ù–ï–®–ù–Ø–Ø PSRAM (External SPIRAM): 8 MB                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  .ext_ram.bss:                          7.4 KB           ‚îÇ
‚îÇ  –î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è heap:                  8179 KB             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  DMA –ü–ê–ú–Ø–¢–¨ (–∏–∑ DRAM heap)                               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  LVGL –±—É—Ñ–µ—Ä—ã (spi_bus_dma_memory_alloc):                 ‚îÇ
‚îÇ  - Buffer 1: 240 √ó 20 √ó 2 = 9.6 KB                       ‚îÇ
‚îÇ  - Buffer 2: 240 √ó 20 √ó 2 = 9.6 KB                       ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ           ‚îÇ
‚îÇ  –ò–¢–û–ì–û DMA:                            19.2 KB            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîç –°–ê–ú–´–ï –ë–û–õ–¨–®–ò–ï –û–ë–™–ï–ö–¢–´ –í –ü–ê–ú–Ø–¢–ò

### ‚ùå –ö–†–ò–¢–ò–ß–ù–û: –û–±—ä–µ–∫—Ç—ã –≤ DRAM (BSS —Å–µ–≥–º–µ–Ω—Ç)

| –°–∏–º–≤–æ–ª | –†–∞–∑–º–µ—Ä | –§–∞–π–ª/–ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ú–æ–∂–Ω–æ –Ω–∞ PSRAM? |
|--------|--------|----------------|-----------------|
| **work_mem_int$5** | **131072 B (128 KB)** | LVGL internal | ‚ö†Ô∏è –ù–ï–¢ (–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ø–∞–º—è—Ç—å LVGL) |
| **g_pid_log_buffer** | **8832 B (~8.6 KB)** | data_logger | ‚úÖ **–î–ê** |
| **g_cnxMgr** | **3880 B (~3.8 KB)** | WiFi (cnx manager) | ‚ùå –ù–ï–¢ (WiFi –æ—Ç–∫–ª—é—á–µ–Ω) |
| **g_states** | **3120 B (~3 KB)** | adaptive_pid.c | ‚úÖ **–î–ê** |
| **port_IntStack** | **3072 B (3 KB)** | FreeRTOS | ‚ùå –ù–ï–¢ (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è RTOS) |
| **g_ScanStruct** | **284 B** | WiFi scan | ‚ùå –ù–ï–¢ (WiFi –æ—Ç–∫–ª—é—á–µ–Ω) |
| **g_system_config** | **800 B** | main (config) | ‚úÖ **–î–ê** |
| **s_cached_config** | **800 B** | main (cache) | ‚úÖ **–î–ê** |
| **tasks** | **800 B** | task_scheduler | ‚ö†Ô∏è –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —á–∞—Å—Ç–æ—Ç—ã –¥–æ—Å—Ç—É–ø–∞ |
| **sensor_history** | **1440 B** | lvgl_ui.c (–≥—Ä–∞—Ñ–∏–∫–∏) | ‚úÖ **–î–ê** |
| **g_results** | **1848 B** | pid_auto_tuner.c | ‚úÖ **–î–ê** |

### üìÅ –ë–û–õ–¨–®–ò–ï –î–ê–ù–ù–´–ï (DATA/RODATA —Å–µ–≥–º–µ–Ω—Ç - Flash)

| –°–∏–º–≤–æ–ª | –†–∞–∑–º–µ—Ä | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|--------|--------|-----------|------------|
| **glyph_bitmap** (4 —à—Ç) | 6-15 KB –∫–∞–∂–¥—ã–π | –®—Ä–∏—Ñ—Ç—ã | ‚úÖ –£–∂–µ –≤ Flash (RODATA) |
| **kern_class_values** (4 —à—Ç) | ~2-5 KB –∫–∞–∂–¥—ã–π | –®—Ä–∏—Ñ—Ç—ã (–∫–µ—Ä–Ω–∏–Ω–≥) | ‚úÖ –£–∂–µ –≤ Flash (RODATA) |
| **glyph_dsc** (5 —à—Ç) | ~1-4 KB –∫–∞–∂–¥—ã–π | –®—Ä–∏—Ñ—Ç—ã | ‚úÖ –£–∂–µ –≤ Flash (RODATA) |

---

## üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò

### ‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢ 1: –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –Ω–∞ PSRAM (—ç–∫–æ–Ω–æ–º–∏—è ~18 KB DRAM)

#### 1. **g_pid_log_buffer** (~8.6 KB)
```c
// components/data_logger/data_logger.c:540
// –ë–´–õ–û:
static pid_log_entry_t g_pid_log_buffer[PID_LOG_BUFFER_SIZE];

// –°–¢–ê–ù–ï–¢:
static pid_log_entry_t *g_pid_log_buffer = NULL;

// –í init:
g_pid_log_buffer = heap_caps_malloc(
    sizeof(pid_log_entry_t) * PID_LOG_BUFFER_SIZE,
    MALLOC_CAP_SPIRAM | MALLOC_CAP_8BIT
);
```

**–í—ã–≥–æ–¥–∞:** 8.6 KB DRAM ‚Üí PSRAM  
**–†–∏—Å–∫:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π (—Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)  
**–°–∫–æ—Ä–æ—Å—Ç—å:** PSRAM –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –ª–æ–≥–æ–≤

#### 2. **g_system_config + s_cached_config** (~1.6 KB)
```c
// main/app_main.c
// –ë–´–õ–û:
static system_config_t g_system_config;
static system_config_t s_cached_config;

// –°–¢–ê–ù–ï–¢:
static system_config_t *g_system_config = NULL;
static system_config_t *s_cached_config = NULL;

// –í app_main():
g_system_config = heap_caps_malloc(sizeof(system_config_t), MALLOC_CAP_SPIRAM);
s_cached_config = heap_caps_malloc(sizeof(system_config_t), MALLOC_CAP_SPIRAM);
```

**–í—ã–≥–æ–¥–∞:** 1.6 KB DRAM ‚Üí PSRAM  
**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π (—á–∏—Ç–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ, —Ä–µ–¥–∫–æ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è)  
**–°–∫–æ—Ä–æ—Å—Ç—å:** PSRAM –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ

#### 3. **g_states** (~3 KB) - adaptive_pid
```c
// components/adaptive_pid/adaptive_pid.c:21
// –ë–´–õ–û:
static adaptive_pid_state_t g_states[PUMP_INDEX_COUNT];

// –°–¢–ê–ù–ï–¢:
static adaptive_pid_state_t *g_states = NULL;

// –í adaptive_pid_init():
if (g_states == NULL) {
    g_states = heap_caps_calloc(
        PUMP_INDEX_COUNT,
        sizeof(adaptive_pid_state_t),
        MALLOC_CAP_SPIRAM | MALLOC_CAP_8BIT
    );
    if (!g_states) {
        ESP_LOGE(TAG, "Failed to allocate adaptive PID states in PSRAM");
        return ESP_ERR_NO_MEM;
    }
    ESP_LOGI(TAG, "Adaptive PID states in PSRAM: %d bytes", 
             PUMP_INDEX_COUNT * sizeof(adaptive_pid_state_t));
}
```

**–í—ã–≥–æ–¥–∞:** 3 KB DRAM ‚Üí PSRAM  
**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π (–≤—ã—á–∏—Å–ª–µ–Ω–∏—è –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã –ø–æ —Å–∫–æ—Ä–æ—Å—Ç–∏)  
**–°–∫–æ—Ä–æ—Å—Ç—å:** PSRAM –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è PID

#### 4. **g_results** (~1.8 KB) - pid_auto_tuner
```c
// components/pid_auto_tuner/pid_auto_tuner.c:21
// –ë–´–õ–û:
static tuning_result_t g_results[PUMP_INDEX_COUNT];

// –°–¢–ê–ù–ï–¢:
static tuning_result_t *g_results = NULL;

// –í pid_auto_tuner_init() –∏–ª–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏:
if (g_results == NULL) {
    g_results = heap_caps_calloc(
        PUMP_INDEX_COUNT,
        sizeof(tuning_result_t),
        MALLOC_CAP_SPIRAM | MALLOC_CAP_8BIT
    );
    if (!g_results) {
        ESP_LOGE(TAG, "Failed to allocate PID tuning results in PSRAM");
        return ESP_ERR_NO_MEM;
    }
    ESP_LOGI(TAG, "PID tuning results in PSRAM: %d bytes",
             PUMP_INDEX_COUNT * sizeof(tuning_result_t));
}
```

**–í—ã–≥–æ–¥–∞:** 1.8 KB DRAM ‚Üí PSRAM  
**–†–∏—Å–∫:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∞–≤—Ç–æ–Ω–∞—Å—Ç—Ä–æ–π–∫–µ)  
**–°–∫–æ—Ä–æ—Å—Ç—å:** PSRAM –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ

#### 5. **sensor_history** (~1.4 KB) - lvgl_ui
```c
// components/lvgl_ui/lvgl_ui.c:247
// –ë–´–õ–û:
static lv_coord_t sensor_history[SENSOR_COUNT][HISTORY_POINTS];  // 6√ó60√ó4 = 1440 –±–∞–π—Ç

// –°–¢–ê–ù–ï–¢:
static lv_coord_t *sensor_history = NULL;

// –í init_styles() –∏–ª–∏ lvgl_main_init():
if (sensor_history == NULL) {
    sensor_history = heap_caps_calloc(
        SENSOR_COUNT * HISTORY_POINTS,
        sizeof(lv_coord_t),
        MALLOC_CAP_SPIRAM | MALLOC_CAP_8BIT
    );
    if (!sensor_history) {
        ESP_LOGE(TAG, "Failed to allocate sensor history in PSRAM");
        return ESP_ERR_NO_MEM;
    }
    ESP_LOGI(TAG, "Sensor history in PSRAM: %d bytes",
             SENSOR_COUNT * HISTORY_POINTS * sizeof(lv_coord_t));
}

// –í–ê–ñ–ù–û: –û–±–Ω–æ–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º:
// –ë–´–õ–û: sensor_history[index][pos]
// –°–¢–ê–ù–ï–¢: sensor_history[index * HISTORY_POINTS + pos]
```

**–í—ã–≥–æ–¥–∞:** 1.4 KB DRAM ‚Üí PSRAM  
**–†–∏—Å–∫:** –°—Ä–µ–¥–Ω–∏–π (—Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏)  
**–°–∫–æ—Ä–æ—Å—Ç—å:** PSRAM –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤

---

### ‚ö†Ô∏è –ü–†–ò–û–†–ò–¢–ï–¢ 2: –ê–Ω–∞–ª–∏–∑ –∏ –≤–æ–∑–º–æ–∂–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

#### 1. **work_mem_int$5** (128 KB) - LVGL –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ø–∞–º—è—Ç—å
- –≠—Ç–æ LVGL working memory –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Ä–∏—Å–æ–≤–∞–Ω–∏—è
- **–ù–ï –ø–µ—Ä–µ–Ω–æ—Å–∏–º** - –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –£–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —á–µ—Ä–µ–∑ `lv_init()`
- –ß–∞—Å—Ç—å LVGL library, –Ω–µ –Ω–∞—à –∫–æ–¥

#### 2. **g_states** (~3 KB)
- –¢—Ä–µ–±—É–µ—Ç –∞–Ω–∞–ª–∏–∑–∞ - –Ω–∞–π—Ç–∏ –≥–¥–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ
- –í–æ–∑–º–æ–∂–Ω–æ state machine –¥–ª—è —ç–∫—Ä–∞–Ω–æ–≤ –∏–ª–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞

#### 3. **FreeRTOS –°—Ç–µ–∫–∏ –∑–∞–¥–∞—á**
```
–¢–µ–∫—É—â–∏–µ —Ä–∞–∑–º–µ—Ä—ã (–≤ —Å–∏—Å—Ç–µ–º–µ):
- LVGL task:      32768 –±–∞–π—Ç (32 KB) ‚Üê –ë–û–õ–¨–®–û–ô!
- Display task:   16384 –±–∞–π—Ç (16 KB)
- Encoder task:   16384 –±–∞–π—Ç (16 KB)
- Sensor task:    16384 –±–∞–π—Ç (16 KB)
- Notification:   10240 –±–∞–π—Ç (10 KB)
- Scheduler:       8192 –±–∞–π—Ç (8 KB)
- Data logger:    14336 –±–∞–π—Ç (14 KB)
- pH/EC ctrl:      8192 –±–∞–π—Ç (8 KB)
```

**–ü–û–¢–ï–ù–¶–ò–ê–õ–¨–ù–ê–Ø –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø:**
–°—Ç–µ–∫–∏ –Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –Ω–∞ PSRAM, –Ω–æ –º–æ–∂–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å:
- LVGL task: 32 KB ‚Üí 24 KB (—ç–∫–æ–Ω–æ–º–∏—è 8 KB)
- Display task: 16 KB ‚Üí 12 KB (—ç–∫–æ–Ω–æ–º–∏—è 4 KB)
- Encoder task: 16 KB ‚Üí 12 KB (—ç–∫–æ–Ω–æ–º–∏—è 4 KB)

**–ò–¢–û–ì–û:** ~16 KB DRAM

---

## üöÄ –ü–õ–ê–ù –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò –î–õ–Ø –í–ö–õ–Æ–ß–ï–ù–ò–Ø WiFi

### –≠—Ç–∞–ø 1: –ü–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö –Ω–∞ PSRAM (~12 KB)

1. g_pid_log_buffer ‚Üí PSRAM (8.6 KB)
2. g_system_config ‚Üí PSRAM (0.8 KB)
3. s_cached_config ‚Üí PSRAM (0.8 KB)
4. sensor_history ‚Üí PSRAM (1.4 KB)
5. g_results ‚Üí PSRAM (1.8 KB)

**–í–´–ì–û–î–ê:** ~13 KB DRAM –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–æ

### –≠—Ç–∞–ø 2: –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Å—Ç–µ–∫–æ–≤ (~16 KB)

1. LVGL task: 32 ‚Üí 24 KB (8 KB)
2. Display task: 16 ‚Üí 12 KB (4 KB)
3. Encoder task: 16 ‚Üí 12 KB (4 KB)

**–í–´–ì–û–î–ê:** ~16 KB DRAM –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–æ

### –≠—Ç–∞–ø 3: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

1. –£–º–µ–Ω—å—à–∏—Ç—å LVGL –±—É—Ñ–µ—Ä—ã: 20 ‚Üí 15 —Å—Ç—Ä–æ–∫ (—ç–∫–æ–Ω–æ–º–∏—è ~4.8 KB)
2. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å WiFi –±—É—Ñ–µ—Ä—ã (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ)

**–í–´–ì–û–î–ê:** ~5 KB DRAM –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–æ

---

## üìà –ò–¢–û–ì–û–í–´–ô –†–ê–°–ß–Å–¢

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï (–±–µ–∑ WiFi):                             ‚ïë
‚ïë  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ     ‚ïë
‚ïë  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ DRAM BSS: ~146 KB                            ‚ïë
‚ïë  –°–≤–æ–±–æ–¥–Ω–æ DRAM heap: ~163 KB (182 - 19 DMA)                ‚ïë
‚ïë  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê   ‚ïë
‚ïë  –ü–û–°–õ–ï –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ô (–ü–ª–∞–Ω –ê):                               ‚ïë
‚ïë  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ     ‚ïë
‚ïë  –≠—Ç–∞–ø 1 (PSRAM –ø–µ—Ä–µ–Ω–æ—Å):     +16.4 KB                      ‚ïë
‚ïë    ‚Ä¢ g_pid_log_buffer:         8.6 KB                      ‚ïë
‚ïë    ‚Ä¢ g_states:                 3.0 KB                      ‚ïë
‚ïë    ‚Ä¢ g_results:                1.8 KB                      ‚ïë
‚ïë    ‚Ä¢ configs:                  1.6 KB                      ‚ïë
‚ïë    ‚Ä¢ sensor_history:           1.4 KB                      ‚ïë
‚ïë                                                            ‚ïë
‚ïë  –≠—Ç–∞–ø 2 (–£–º–µ–Ω—å—à–µ–Ω–∏–µ —Å—Ç–µ–∫–æ–≤): +16.0 KB                      ‚ïë
‚ïë    ‚Ä¢ LVGL task: 32‚Üí24 KB       8.0 KB                      ‚ïë
‚ïë    ‚Ä¢ Display: 16‚Üí12 KB         4.0 KB                      ‚ïë
‚ïë    ‚Ä¢ Encoder: 16‚Üí12 KB         4.0 KB                      ‚ïë
‚ïë                                                            ‚ïë
‚ïë  –≠—Ç–∞–ø 3 (–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è LVGL):   + 4.8 KB                     ‚ïë
‚ïë    ‚Ä¢ –ë—É—Ñ–µ—Ä—ã: 20‚Üí15 —Å—Ç—Ä–æ–∫       4.8 KB                      ‚ïë
‚ïë  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ     ‚ïë
‚ïë  –ò–¢–û–ì–û –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–æ:           +37.2 KB                     ‚ïë
‚ïë  –°–≤–æ–±–æ–¥–Ω–æ DRAM heap:         ~200 KB                       ‚ïë
‚ïë  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê   ‚ïë
‚ïë  WiFi —Ç—Ä–µ–±—É–µ—Ç –º–∏–Ω–∏–º—É–º:        ~40 KB                       ‚ïë
‚ïë  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ   ‚ïë
‚ïë  –†–ï–ó–£–õ–¨–¢–ê–¢: 200 - 40 = 160 KB —Å–≤–æ–±–æ–¥–Ω–æ                     ‚ïë
‚ïë  ‚úÖ WIFI –ë–£–î–ï–¢ –†–ê–ë–û–¢–ê–¢–¨ –° –ó–ê–ü–ê–°–û–ú!                         ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

---

## ‚ö° –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò

### –®–∞–≥ 1: –ü–µ—Ä–µ–Ω–æ—Å g_pid_log_buffer –Ω–∞ PSRAM

```c
// components/data_logger/data_logger.c

// –ò–ó–ú–ï–ù–ò–¢–¨ —Å—Ç—Ä–æ–∫—É 540:
// static pid_log_entry_t g_pid_log_buffer[PID_LOG_BUFFER_SIZE];
static pid_log_entry_t *g_pid_log_buffer = NULL;

// –î–æ–±–∞–≤–∏—Ç—å –≤ data_logger_init():
if (g_pid_log_buffer == NULL) {
    g_pid_log_buffer = heap_caps_calloc(
        PID_LOG_BUFFER_SIZE,
        sizeof(pid_log_entry_t),
        MALLOC_CAP_SPIRAM | MALLOC_CAP_8BIT
    );
    if (!g_pid_log_buffer) {
        ESP_LOGE(TAG, "Failed to allocate PID log buffer in PSRAM");
        return ESP_ERR_NO_MEM;
    }
    ESP_LOGI(TAG, "PID log buffer allocated in PSRAM: %d bytes", 
             PID_LOG_BUFFER_SIZE * sizeof(pid_log_entry_t));
}
```

### –®–∞–≥ 2: –ü–µ—Ä–µ–Ω–æ—Å –∫–æ–Ω—Ñ–∏–≥–æ–≤ –Ω–∞ PSRAM

```c
// main/app_main.c

// –ò–ó–ú–ï–ù–ò–¢–¨ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
// static system_config_t g_system_config;
// static system_config_t s_cached_config;
static system_config_t *g_system_config = NULL;
static system_config_t *s_cached_config = NULL;

// –í app_main() –ü–ï–†–ï–î –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º:
g_system_config = heap_caps_calloc(1, sizeof(system_config_t), MALLOC_CAP_SPIRAM);
s_cached_config = heap_caps_calloc(1, sizeof(system_config_t), MALLOC_CAP_SPIRAM);

// –í–ê–ñ–ù–û: –í—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ g_system_config –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ *g_system_config –∏–ª–∏ g_system_config->
```

### –®–∞–≥ 3: –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Å—Ç–µ–∫–æ–≤

```c
// components/lcd_ili9341/lcd_ili9341.c:94
#define LVGL_TASK_STACK_SIZE  (24 * 1024)  // –ë—ã–ª–æ 32 KB, —Å—Ç–∞–ª–æ 24 KB

// main/system_config.h
#define TASK_STACK_SIZE_DISPLAY       3072  // –ë—ã–ª–æ 4096
#define TASK_STACK_SIZE_ENCODER       3072  // –ë—ã–ª–æ 4096
```

---

## ‚ùå –ü–û–ß–ï–ú–£ WiFi –ù–ï –†–ê–ë–û–¢–ê–ï–¢ –°–ï–ô–ß–ê–°

### –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:

```
W (3939) wifi:malloc buffer fail
E (3950) wifi:Expected to init 16 rx buffer, actual is 0
ESP_ERROR_CHECK failed: esp_err_t 0x101 (ESP_ERR_NO_MEM)
```

### –ü—Ä–∏—á–∏–Ω–∞:

WiFi –¥—Ä–∞–π–≤–µ—Ä –ø—ã—Ç–∞–µ—Ç—Å—è –≤—ã–¥–µ–ª–∏—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ RX –±—É—Ñ–µ—Ä—ã –∏–∑ DRAM:
```
CONFIG_ESP_WIFI_STATIC_RX_BUFFER_NUM=16  (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª)
16 –±—É—Ñ–µ—Ä–æ–≤ √ó 1.6 KB = 25.6 KB
```

–ù–æ —Å–≤–æ–±–æ–¥–Ω–æ DRAM heap —Ç–æ–ª—å–∫–æ ~163 KB, –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö:
- FreeRTOS —Å—Ç–µ–∫–∏: ~120 KB
- –ú—å—é—Ç–µ–∫—Å—ã, –æ—á–µ—Ä–µ–¥–∏: ~10 KB
- LVGL DMA –±—É—Ñ–µ—Ä—ã: 19.2 KB
- –ü—Ä–æ—á–µ–µ: ~10 KB

**–û–°–¢–ê–Å–¢–°–Ø:** ~3-4 KB üò¢

---

## üéØ –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø: –ü–û–®–ê–ì–û–í–´–ô –ü–õ–ê–ù

### –ü–ª–∞–Ω –ê: –ú–∏–Ω –∏–º–∞–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–¥–ª—è WiFi STA mode)

1. ‚úÖ –ü–µ—Ä–µ–Ω–æ—Å g_pid_log_buffer –Ω–∞ PSRAM (+8.6 KB)
2. ‚úÖ –ü–µ—Ä–µ–Ω–æ—Å g_states –Ω–∞ PSRAM (+3.0 KB)
3. ‚úÖ –ü–µ—Ä–µ–Ω–æ—Å g_results –Ω–∞ PSRAM (+1.8 KB)
4. ‚úÖ –ü–µ—Ä–µ–Ω–æ—Å –∫–æ–Ω—Ñ–∏–≥–æ–≤ –Ω–∞ PSRAM (+1.6 KB)
5. ‚úÖ –ü–µ—Ä–µ–Ω–æ—Å sensor_history –Ω–∞ PSRAM (+1.4 KB)

**–ò–¢–û–ì–û –≠—Ç–∞–ø 1 (PSRAM):** +16.4 KB DRAM

6. ‚úÖ –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Å—Ç–µ–∫–æ–≤ (+16 KB)
7. ‚úÖ –£–º–µ–Ω—å—à–µ–Ω–∏–µ LVGL –±—É—Ñ–µ—Ä–æ–≤: 20‚Üí15 —Å—Ç—Ä–æ–∫ (+4.8 KB)

**–ò–¢–û–ì–û:** +37.2 KB DRAM  
**–†–ï–ó–£–õ–¨–¢–ê–¢:** WiFi **–ë–£–î–ï–¢ –†–ê–ë–û–¢–ê–¢–¨**

### –ü–ª–∞–Ω –ë: –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (—Ä–µ–∑–µ—Ä–≤)

1. –í—Å—ë –∏–∑ –ü–ª–∞–Ω–∞ –ê (+37.2 KB)
2. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å LVGL: 15‚Üí10 —Å—Ç—Ä–æ–∫ (+4.8 KB)
3. –£–º–µ–Ω—å—à–∏—Ç—å notification queue: 20 ‚Üí 10 (+~1 KB)
4. –£–º–µ–Ω—å—à–∏—Ç—å sensor task stack: 16 ‚Üí 12 KB (+4 KB)

**–ò–¢–û–ì–û:** +47 KB DRAM  
**–†–ï–ó–£–õ–¨–¢–ê–¢:** WiFi —Å –±–æ–ª—å—à–∏–º –∑–∞–ø–∞—Å–æ–º + –º–µ—Å—Ç–æ –¥–ª—è —Ä–æ—Å—Ç–∞

---

## üìù –§–ê–ô–õ–´ –î–õ–Ø –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### 1. components/data_logger/data_logger.c
- –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `g_pid_log_buffer` –Ω–∞ PSRAM
- –õ–∏–Ω–∏—è: 540
- –§—É–Ω–∫—Ü–∏—è: `data_logger_init()` –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é

### 2. components/adaptive_pid/adaptive_pid.c
- –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `g_states` –Ω–∞ PSRAM
- –õ–∏–Ω–∏—è: 21
- –§—É–Ω–∫—Ü–∏—è: `adaptive_pid_init()`

### 3. components/pid_auto_tuner/pid_auto_tuner.c
- –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `g_results` –Ω–∞ PSRAM
- –õ–∏–Ω–∏—è: 21
- –§—É–Ω–∫—Ü–∏—è: –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏

### 4. components/lvgl_ui/lvgl_ui.c
- –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `sensor_history` –Ω–∞ PSRAM
- –õ–∏–Ω–∏–∏: 247-249
- –§—É–Ω–∫—Ü–∏—è: `lvgl_main_init()` –∏–ª–∏ `init_styles()`
- **–í–ê–ñ–ù–û:** –ò–∑–º–µ–Ω–∏—Ç—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é —Å [i][j] –Ω–∞ [i*HISTORY_POINTS + j]

### 5. main/app_main.c
- –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `g_system_config` –∏ `s_cached_config` –Ω–∞ PSRAM
- –í—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —É–∫–∞–∑–∞—Ç–µ–ª–∏ (–º–Ω–æ–≥–æ –º–µ—Å—Ç!)
- **–ö–†–ò–¢–ò–ß–ù–û:** –í—Å–µ `g_system_config.field` ‚Üí `g_system_config->field`

### 6. components/lcd_ili9341/lcd_ili9341.c
- –£–º–µ–Ω—å—à–∏—Ç—å `LVGL_TASK_STACK_SIZE`: 32‚Üí24 KB (–ª–∏–Ω–∏—è ~94)
- –£–º–µ–Ω—å—à–∏—Ç—å –±—É—Ñ–µ—Ä—ã: 20‚Üí15 —Å—Ç—Ä–æ–∫ (–ª–∏–Ω–∏—è ~400)

### 7. main/system_config.h
- –£–º–µ–Ω—å—à–∏—Ç—å `TASK_STACK_SIZE_DISPLAY`: 16384‚Üí12288
- –£–º–µ–Ω—å—à–∏—Ç—å `TASK_STACK_SIZE_ENCODER`: 16384‚Üí12288
- –£–º–µ–Ω—å—à–∏—Ç—å `TASK_STACK_SIZE_SENSOR`: 16384‚Üí12288 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –í–´–í–û–î

**ESP32-S3 —Å 328 KB DRAM –Ω–∞ –≥—Ä–∞–Ω–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è:**
- LVGL UI (—Ç—Ä–µ–±—É–µ—Ç –±—ã—Å—Ç—Ä—ã–π DRAM –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏)
- WiFi (—Ç—Ä–µ–±—É–µ—Ç ~40 KB DRAM –¥–ª—è –±—É—Ñ–µ—Ä–æ–≤)
- FreeRTOS (—Ç—Ä–µ–±—É–µ—Ç —Å—Ç–µ–∫–∏ –¥–ª—è –∑–∞–¥–∞—á)

**–¢–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**
- LVGL —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ ‚úÖ
- WiFi –æ—Ç–∫–ª—é—á–µ–Ω ‚ùå

**–î–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è WiFi:**
–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é (–ü–ª–∞–Ω –ê –∏–ª–∏ –ë)

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ESP32-S3 —Å –±–æ–ª—å—à–∏–º DRAM (–Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏–º–µ—é—Ç 512 KB)

---

## üìä –ò–ù–°–¢–†–£–ú–ï–ù–¢–´ –î–õ–Ø –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê

### –ü—Ä–æ–≤–µ—Ä–∫–∞ DRAM –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

```c
#include "esp_heap_caps.h"

// –í –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–æ—á–∫–∞—Ö:
size_t free_dram = heap_caps_get_free_size(MALLOC_CAP_INTERNAL);
size_t free_psram = heap_caps_get_free_size(MALLOC_CAP_SPIRAM);
ESP_LOGI("MEM", "Free DRAM: %d bytes, Free PSRAM: %d bytes", free_dram, free_psram);
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –æ–±—ä–µ–∫—Ç–æ–≤:

```bash
# –°–∞–º—ã–µ –±–æ–ª—å—à–∏–µ —Å–∏–º–≤–æ–ª—ã –≤ BSS:
xtensa-esp32s3-elf-nm --size-sort --print-size hydroponics.elf | grep " B "

# –†–∞–∑–º–µ—Ä —Å–µ–∫—Ü–∏–π:
xtensa-esp32s3-elf-size -A hydroponics.elf
```

---

## ‚úÖ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ LVGL —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ (19.2 KB DMA –±—É—Ñ–µ—Ä—ã)
- ‚úÖ –í—Å–µ –¥–∞—Ç—á–∏–∫–∏, –Ω–∞—Å–æ—Å—ã, UI —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞
- ‚ùå WiFi –æ—Ç–∫–ª—é—á–µ–Ω (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ DRAM)

**–î–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è WiFi:**
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ü–ª–∞–Ω –ê (—ç–∫–æ–Ω–æ–º–∏—è 31 KB DRAM) - **–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø**

**–ü—Ä–æ–≥–Ω–æ–∑:**
–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ WiFi **–î–û–õ–ñ–ï–ù —Ä–∞–±–æ—Ç–∞—Ç—å** —Å –∑–∞–ø–∞—Å–æ–º ~20 KB DRAM.

---

**–û—Ç—á—ë—Ç —Å–æ—Å—Ç–∞–≤–ª–µ–Ω:** 16 –æ–∫—Ç—è–±—Ä—è 2025, 15:45  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ üöÄ

