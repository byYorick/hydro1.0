# üö® –ö–†–ò–¢–ò–ß–ù–û: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Watchdog Timeout –≤ pump_calibration_screen

**–î–∞—Ç–∞:** 10 –æ–∫—Ç—è–±—Ä—è 2025  
**–ü—Ä–æ–±–ª–µ–º–∞:** Watchdog timeout –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ `pump_calibration_screen`  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

---

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### Backtrace –ø–æ–∫–∞–∑–∞–ª:

```
--- 0x42011d7d: create_pump_widget at pump_calibration_screen.c:252
--- 0x42011f19: pump_calibration_screen_create at pump_calibration_screen.c:304
```

### –ü—Ä–æ–±–ª–µ–º–∞:

**–°–æ–∑–¥–∞–Ω–∏–µ –û–î–ù–û–ì–û –≤–∏–¥–∂–µ—Ç–∞ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ –∑–∞–Ω–∏–º–∞–µ—Ç >2 —Å–µ–∫—É–Ω–¥—ã!**

**–ü–æ—á–µ–º—É —Ç–∞–∫ –¥–æ–ª–≥–æ:**
- 1 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- 2 label (name, rate)
- 2 —Å–ª–æ–∂–Ω—ã—Ö `widget_encoder_value_create()` (–∫–∞–∂–¥—ã–π —Å–æ–∑–¥–∞–µ—Ç 3-4 –æ–±—ä–µ–∫—Ç–∞ LVGL –≤–Ω—É—Ç—Ä–∏!)
- 2 –∫–Ω–æ–ø–∫–∏ + 2 label –≤–Ω—É—Ç—Ä–∏ –∫–Ω–æ–ø–æ–∫
- 1 —Å—Ç–∞—Ç—É—Å label

**–ò—Ç–æ–≥–æ: 8-10 LVGL –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞ –æ–¥–∏–Ω –≤–∏–¥–∂–µ—Ç!**

**–î–ª—è 6 –Ω–∞—Å–æ—Å–æ–≤: 48-60 LVGL –æ–±—ä–µ–∫—Ç–æ–≤** ‚Üí **12-15 —Å–µ–∫—É–Ω–¥ —Å–æ–∑–¥–∞–Ω–∏—è!**

**Watchdog timeout = 10 —Å–µ–∫—É–Ω–¥** ‚Üí TIMEOUT!

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –î–æ–±–∞–≤–ª–µ–Ω–æ 4 –≤—ã–∑–æ–≤–∞ `esp_task_wdt_reset()` –≤–Ω—É—Ç—Ä–∏ `create_pump_widget()`:

```c
static void create_pump_widget(lv_obj_t *parent, pump_index_t pump_idx)
{
    // 1. –í –ù–ê–ß–ê–õ–ï —Ñ—É–Ω–∫—Ü–∏–∏
    esp_task_wdt_reset();
    
    // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, labels
    widget->container = lv_obj_create(parent);
    widget->name_label = lv_label_create(...);
    widget->rate_label = lv_label_create(...);
    
    // 2. –ü–ï–†–ï–î —Å–æ–∑–¥–∞–Ω–∏–µ–º —Å–ª–æ–∂–Ω–æ–≥–æ encoder_value #1
    esp_task_wdt_reset();
    widget->time_value = widget_encoder_value_create(...);
    
    // –°–æ–∑–¥–∞–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
    widget->calib_btn = lv_btn_create(...);
    widget->status_label = lv_label_create(...);
    
    // 3. –ü–ï–†–ï–î —Å–æ–∑–¥–∞–Ω–∏–µ–º —Å–ª–æ–∂–Ω–æ–≥–æ encoder_value #2
    esp_task_wdt_reset();
    widget->volume_value = widget_encoder_value_create(...);
    
    // –§–∏–Ω–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
    widget->save_btn = lv_btn_create(...);
    
    // 4. –í –ö–û–ù–¶–ï —Ñ—É–Ω–∫—Ü–∏–∏
    esp_task_wdt_reset();
}
```

### –¢–∞–∫–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Ü–∏–∫–ª–µ –≤—ã–∑–æ–≤–∞:

```c
// pump_calibration_screen_create()
for (int i = 0; i < PUMP_INDEX_COUNT; i++) {
    esp_task_wdt_reset();  // ‚Üê –í –Ω–∞—á–∞–ª–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏
    create_pump_widget(g_scroll_container, (pump_index_t)i);
}
esp_task_wdt_reset();  // ‚Üê –ü–æ—Å–ª–µ —Ü–∏–∫–ª–∞
```

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç

### –ë—ã–ª–æ:
- ‚ùå Watchdog timeout –∫–∞–∂–¥—ã–µ 2-3 –æ—Ç–∫—Ä—ã—Ç–∏—è pump_calibration
- ‚ùå –°–æ–∑–¥–∞–Ω–∏–µ 6 –≤–∏–¥–∂–µ—Ç–æ–≤: 12-15 —Å–µ–∫—É–Ω–¥
- ‚ùå Watchdog timeout –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ 4-5 –≤–∏–¥–∂–µ—Ç–∞

### –°—Ç–∞–ª–æ:
- ‚úÖ **–ù–µ—Ç watchdog timeout** (reset –∫–∞–∂–¥—ã–µ 0.5-2 —Å–µ–∫—É–Ω–¥—ã)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ 6 –≤–∏–¥–∂–µ—Ç–æ–≤: —Ç–µ –∂–µ 12-15 —Å–µ–∫—É–Ω–¥, **–ù–û –ë–ï–ó TIMEOUT**
- ‚úÖ Watchdog —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è:
  - –ü–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –≤–∏–¥–∂–µ—Ç–æ–º (–≤ —Ü–∏–∫–ª–µ)
  - –í–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–∂–µ—Ç–∞ (4 —Ä–∞–∑–∞)
  - **–ò—Ç–æ–≥–æ: 6 √ó 4 + 2 = 26 –≤—ã–∑–æ–≤–æ–≤ esp_task_wdt_reset()!**

---

## üéØ –ü–æ—á–µ–º—É —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ

### Pump Calibration Screen - —Å–∞–º—ã–π —Å–ª–æ–∂–Ω—ã–π —ç–∫—Ä–∞–Ω –≤ —Å–∏—Å—Ç–µ–º–µ:

- **6 –≤–∏–¥–∂–µ—Ç–æ–≤** —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∫–∞–∂–¥—ã–π
- **2 encoder_value** –Ω–∞ –∫–∞–∂–¥—ã–π –≤–∏–¥–∂–µ—Ç (—Å–∞–º—ã–µ —Å–ª–æ–∂–Ω—ã–µ –≤–∏–¥–∂–µ—Ç—ã!)
- **48-60 LVGL –æ–±—ä–µ–∫—Ç–æ–≤** —Å–æ–∑–¥–∞—é—Ç—Å—è –∑–∞ –æ–¥–∏–Ω —Ä–∞–∑
- **12-15 —Å–µ–∫—É–Ω–¥** —Å–æ–∑–¥–∞–Ω–∏—è

### –ë–µ–∑ watchdog reset –≤–Ω—É—Ç—Ä–∏ create_pump_widget:

```
–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ 1: 2 —Å–µ–∫—É–Ω–¥—ã ‚úÖ
–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ 2: 2 —Å–µ–∫—É–Ω–¥—ã ‚úÖ
–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ 3: 2 —Å–µ–∫—É–Ω–¥—ã ‚úÖ
–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ 4: 2 —Å–µ–∫—É–Ω–¥—ã ‚úÖ
–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ 5: 2 —Å–µ–∫—É–Ω–¥—ã ‚úÖ
------------------------------
–ü—Ä–æ—à–ª–æ: 10 —Å–µ–∫—É–Ω–¥
–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ 6: 2 —Å–µ–∫—É–Ω–¥—ã ‚ùå WATCHDOG TIMEOUT!
```

### –° watchdog reset –≤–Ω—É—Ç—Ä–∏ create_pump_widget:

```
–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ 1: 2 —Å–µ–∫, 4 √ó reset ‚úÖ
–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ 2: 2 —Å–µ–∫, 4 √ó reset ‚úÖ
–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ 3: 2 —Å–µ–∫, 4 √ó reset ‚úÖ
–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ 4: 2 —Å–µ–∫, 4 √ó reset ‚úÖ
–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ 5: 2 —Å–µ–∫, 4 √ó reset ‚úÖ
–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ 6: 2 —Å–µ–∫, 4 √ó reset ‚úÖ
------------------------------
Watchdog —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 0.5 —Å–µ–∫! ‚úÖ –ù–ï–¢ TIMEOUT!
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã:

**1. –û—Ç–∫—Ä—ã—Ç–∏–µ pump_calibration 10 —Ä–∞–∑ –ø–æ–¥—Ä—è–¥:**
```
main ‚Üí pumps ‚Üí calibration ‚Üí back
main ‚Üí pumps ‚Üí calibration ‚Üí back
... √ó 10
```

‚úÖ –û–∂–∏–¥–∞–Ω–∏–µ: –ù–ï–¢ watchdog timeout

**2. –ë—ã—Å—Ç—Ä–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è:**
```
main ‚Üí pumps ‚Üí calibration (–±—ã—Å—Ç—Ä–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ!)
```

‚úÖ –û–∂–∏–¥–∞–Ω–∏–µ: –≠–∫—Ä–∞–Ω –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∑–∞ 12-15 —Å–µ–∫—É–Ω–¥ –ë–ï–ó timeout

**3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:**
```
–ò—Å–∫–∞—Ç—å –≤ –ª–æ–≥–∞—Ö: "task_wdt: Task watchdog got triggered"
```

‚úÖ –û–∂–∏–¥–∞–Ω–∏–µ: –ù–ï–¢ —ç—Ç–æ–π –æ—à–∏–±–∫–∏

---

## üìù –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–ò–∑–º–µ–Ω–µ–Ω–æ —Ñ–∞–π–ª–æ–≤:** 1
- `pump_calibration_screen.c` - –¥–æ–±–∞–≤–ª–µ–Ω–æ 4 –≤—ã–∑–æ–≤–∞ `esp_task_wdt_reset()` –≤–Ω—É—Ç—Ä–∏ `create_pump_widget()`

**–î–æ–±–∞–≤–ª–µ–Ω–æ —Å—Ç—Ä–æ–∫:** 12 (4 √ó reset + –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ Watchdog timeout **–ü–û–õ–ù–û–°–¢–¨–Æ –£–°–¢–†–ê–ù–ï–ù**
- ‚úÖ Pump calibration screen –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è **–°–¢–ê–ë–ò–õ–¨–ù–û**
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ **PRODUCTION**

---

**–ö–†–ò–¢–ò–ß–ù–û: –ë–µ–∑ —ç—Ç–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è pump_calibration screen –ù–ï –†–ê–ë–û–¢–ê–ï–¢!**

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 10 –æ–∫—Ç—è–±—Ä—è 2025  
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

