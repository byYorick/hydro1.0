# üö® –ö–†–ò–¢–ò–ß–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï - WATCHDOG TIMEOUT

**–î–∞—Ç–∞:** 16 –æ–∫—Ç—è–±—Ä—è 2025  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û  

---

## ‚ùå –ü–†–û–ë–õ–ï–ú–ê

### Watchdog Timeout –≤ –∑–∞–¥–∞—á–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è dashboard

**–õ–æ–≥ –æ—à–∏–±–∫–∏:**
```
E (34271) task_wdt: Task watchdog got triggered
E (34271) task_wdt: CPU 1: pid_dash_upd
E (34271) task_wdt: Tasks currently running:
E (34271) task_wdt: CPU 0: IDLE0
E (34271) task_wdt: CPU 1: pid_dash_upd
```

**Backtrace:**
```
--- widget_intelligent_pid_card_update at intelligent_pid_card.c:149
--- dashboard_update_task at pid_intelligent_dashboard.c:145
```

### –ü—Ä–∏—á–∏–Ω–∞:

**–§–∞–π–ª:** `components/lvgl_ui/screens/adaptive/pid_intelligent_dashboard.c`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ó–∞–¥–∞—á–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç 6 –∫–∞—Ä—Ç–æ—á–µ–∫ PID –≤ —Ü–∏–∫–ª–µ
- –î–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏:
  - –í—ã–∑—ã–≤–∞–µ—Ç `pump_manager_compute_pid()` (–∑–∞–Ω–∏–º–∞–µ—Ç –≤—Ä–µ–º—è)
  - –û–±–Ω–æ–≤–ª—è–µ—Ç LVGL –≤–∏–¥–∂–µ—Ç—ã (—Ç—è–∂–µ–ª–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è)
  - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å
- **–í—Å—ë —ç—Ç–æ –ø–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π LVGL!**
- –°–±—Ä–æ—Å watchdog —Ç–æ–ª—å–∫–æ –≤ –Ω–∞—á–∞–ª–µ —Ü–∏–∫–ª–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ 6 –∫–∞—Ä—Ç–æ—á–µ–∫ –∑–∞–Ω–∏–º–∞–µ—Ç > 5 —Å–µ–∫—É–Ω–¥ ‚Üí watchdog timeout!

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï

### –î–æ–±–∞–≤–ª–µ–Ω —Å–±—Ä–æ—Å watchdog –≤–Ω—É—Ç—Ä–∏ —Ü–∏–∫–ª–∞

**–î–æ:**
```c
while (g_screen_active) {
    esp_task_wdt_reset();  // –¢–æ–ª—å–∫–æ –≤ –Ω–∞—á–∞–ª–µ —Ü–∏–∫–ª–∞
    
    lv_lock();
    
    for (int i = 0; i < PUMP_INDEX_COUNT; i++) {  // 6 –∏—Ç–µ—Ä–∞—Ü–∏–π
        if (g_cards[i]) {
            // –¢—è–∂–µ–ª—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–µ–∑ —Å–±—Ä–æ—Å–∞ watchdog!
            pump_manager_compute_pid(...);
            widget_intelligent_pid_card_update(...);
            determine_status(...);
        }
    }
    
    update_prediction_panel();
    lv_unlock();
    
    vTaskDelay(2000);
}
```

**–ü–æ—Å–ª–µ:**
```c
while (g_screen_active) {
    esp_task_wdt_reset();  // –°–±—Ä–æ—Å –≤ –Ω–∞—á–∞–ª–µ
    
    lv_lock();
    
    for (int i = 0; i < PUMP_INDEX_COUNT; i++) {  // 6 –∏—Ç–µ—Ä–∞—Ü–∏–π
        esp_task_wdt_reset();  // ‚≠ê –°–±—Ä–æ—Å –¥–ª—è –ö–ê–ñ–î–û–ô –∫–∞—Ä—Ç–æ—á–∫–∏!
        
        if (g_cards[i]) {
            pump_manager_compute_pid(...);
            widget_intelligent_pid_card_update(...);
            determine_status(...);
        }
    }
    
    update_prediction_panel();
    lv_unlock();
    
    vTaskDelay(2000);
}
```

---

## üéØ –ß–¢–û –ò–ó–ú–ï–ù–ï–ù–û

**–§–∞–π–ª:** `components/lvgl_ui/screens/adaptive/pid_intelligent_dashboard.c`

**–°—Ç—Ä–æ–∫–∞:** 138

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
```c
// –î–æ–±–∞–≤–ª–µ–Ω–æ:
for (int i = 0; i < PUMP_INDEX_COUNT; i++) {
    esp_task_wdt_reset();  // ‚≠ê –ù–û–í–ê–Ø –°–¢–†–û–ö–ê
    
    if (g_cards[i]) {
        // ...
    }
}
```

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –°–±–æ—Ä–∫–∞:
```
‚úÖ Project build complete
‚úÖ –†–∞–∑–º–µ—Ä: 787 KB
‚úÖ –û—à–∏–±–æ–∫: 0
‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ—à–∏–≤–∫–µ
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –ø—Ä–æ—à–∏–≤–∫–∏:
- ‚úÖ Watchdog timeout –∏—Å—á–µ–∑–Ω–µ—Ç
- ‚úÖ Dashboard –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –ø–ª–∞–≤–Ω–æ
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞

---

## üí° –ü–û–ß–ï–ú–£ –≠–¢–û –ö–†–ò–¢–ò–ß–ù–û

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
1. **Watchdog timeout** ‚Üí —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —ç–∫—Ä–∞–Ω ‚Üí **crash!**
3. –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å dashboard
4. –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
1. ‚úÖ –ù–∏–∫–∞–∫–∏—Ö timeout
2. ‚úÖ –ü–ª–∞–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
3. ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞
4. ‚úÖ –•–æ—Ä–æ—à–∏–π UX

---

## üîß –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –±—É–¥—É—â–µ–≥–æ:

1. **–£–º–µ–Ω—å—à–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É:**
   ```c
   // –û–±–Ω–æ–≤–ª—è—Ç—å –Ω–µ –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å—Ä–∞–∑—É, –∞ –ø–æ –æ—á–µ—Ä–µ–¥–∏
   int card_to_update = (update_cycle % PUMP_INDEX_COUNT);
   update_only_one_card(card_to_update);
   ```

2. **–í—ã–Ω–µ—Å—Ç–∏ —Ä–∞—Å—á–µ—Ç—ã –∏–∑ UI –∑–∞–¥–∞—á–∏:**
   ```c
   // PID —Ä–∞—Å—á–µ—Ç—ã –¥–µ–ª–∞—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –∑–∞–¥–∞—á–µ
   // UI —Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
   ```

3. **–£–≤–µ–ª–∏—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
   ```c
   // –ë—ã–ª–æ: 2 —Å–µ–∫—É–Ω–¥—ã
   // –ú–æ–∂–Ω–æ: 3-5 —Å–µ–∫—É–Ω–¥ (PID –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —á–∞—Å—Ç–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
   const TickType_t UPDATE_INTERVAL = pdMS_TO_TICKS(3000);
   ```

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê

### –î–æ –ø—Ä–æ—à–∏–≤–∫–∏:
- [x] –ö–æ–¥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- [x] –°–±—Ä–æ—Å watchdog –¥–æ–±–∞–≤–ª–µ–Ω
- [x] –ü—Ä–æ–µ–∫—Ç —Å–æ–±—Ä–∞–Ω
- [x] –û—à–∏–±–æ–∫ –Ω–µ—Ç

### –ü–æ—Å–ª–µ –ø—Ä–æ—à–∏–≤–∫–∏ (TODO):
- [ ] –û—Ç–∫—Ä—ã—Ç—å dashboard
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ watchdog timeout
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è –≤ –ø–ª–∞–≤–Ω–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å 5+ –º–∏–Ω—É—Ç

---

## üéì –£–†–û–ö –î–õ–Ø AI

### –ö—Ä–∏—Ç–∏—á–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ:

**–í–°–ï–ì–î–ê –¥–æ–±–∞–≤–ª—è–π `esp_task_wdt_reset()` –≤ —Ü–∏–∫–ª—ã, –æ—Å–æ–±–µ–Ω–Ω–æ:**
- –í —Ü–∏–∫–ª–∞—Ö —Å LVGL –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
- –ü—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- –í –∑–∞–¥–∞—á–∞—Ö —Å —Ç—è–∂–µ–ª—ã–º–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è–º–∏
- –ï—Å–ª–∏ –æ–¥–Ω–∞ –∏—Ç–µ—Ä–∞—Ü–∏—è > 1 —Å–µ–∫—É–Ω–¥—ã

### –®–∞–±–ª–æ–Ω:

```c
while (running) {
    esp_task_wdt_reset();  // –í –Ω–∞—á–∞–ª–µ —Ü–∏–∫–ª–∞
    
    for (int i = 0; i < COUNT; i++) {
        esp_task_wdt_reset();  // ‚≠ê –í–Ω—É—Ç—Ä–∏ –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞!
        
        // –¢—è–∂–µ–ª—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
    }
    
    vTaskDelay(INTERVAL);
}
```

---

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ—à–∏–≤–∫–µ!** üöÄ


