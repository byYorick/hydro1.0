# ะััะตั ะพ ะฟะตัะตะฟัะพะฒะตัะบะต ะปะพะณะธะบะธ

**ะะฐัะฐ:** 2025-10-09  
**ะะตััะธั:** 1.1 (ะฟะพัะปะต ะฟะตัะตะฟัะพะฒะตัะบะธ)  
**ะกัะฐััั:** โ ะัะต ะฟัะพะฑะปะตะผั ะธัะฟัะฐะฒะปะตะฝั

---

## ๐ ะะฑะฝะฐััะถะตะฝะฝัะต ะธ ะธัะฟัะฐะฒะปะตะฝะฝัะต ะฟัะพะฑะปะตะผั

### 1. โ ะะฑัะพะด ะฝะฐัะธะฝะฐะปัั ั ะบะพัะฝะตะฒะพะณะพ ะพะฑัะตะบัะฐ ัะบัะฐะฝะฐ

**ะัะพะฑะปะตะผะฐ:**
```c
// ะะซะะ:
queue[queue_tail++] = root_obj;  // ะะพะฑะฐะฒะปัะปะธ ัะฐะผ ัะบัะฐะฝ ะฒ ะพัะตัะตะดั
```

ะะพัะฝะตะฒะพะน ะพะฑัะตะบั ัะบัะฐะฝะฐ (`lv_obj_create(NULL)`) - ััะพ ะบะพะฝัะตะนะฝะตั, ะบะพัะพััะน ะฝะต ะดะพะปะถะตะฝ ะฑััั ะธะฝัะตัะฐะบัะธะฒะฝัะผ.

**ะัะฟัะฐะฒะปะตะฝะธะต:**
```c
// ะกะขะะะ:
// ะะฐัะธะฝะฐะตะผ ััะฐะทั ั ะดะตัะตะน ะบะพัะฝะตะฒะพะณะพ ะพะฑัะตะบัะฐ
uint32_t root_child_count = lv_obj_get_child_count(root_obj);
for (uint32_t i = 0; i < root_child_count; i++) {
    lv_obj_t *child = lv_obj_get_child(root_obj, i);
    if (child) {
        queue[queue_tail++] = child;
    }
}
```

**ะะตะทัะปััะฐั:** โ ะขะตะฟะตัั ะฟัะพะฒะตัััััั ัะพะปัะบะพ ัะตะฐะปัะฝัะต ะฒะธะดะถะตัั, ะฐ ะฝะต ะบะพะฝัะตะนะฝะตั ัะบัะฐะฝะฐ

---

### 2. โ ะะตะพะดะฝะพะทะฝะฐัะฝะพะต ััะปะพะฒะธะต ะณะปัะฑะธะฝั

**ะัะพะฑะปะตะผะฐ:**
```c
// ะะซะะ:
while (queue_head < queue_tail && current_depth <= max_depth)
```

ะฃัะปะพะฒะธะต `<= max_depth` ะพะทะฝะฐัะฐะตั ะพะฑัะฐะฑะพัะบั ััะพะฒะฝะตะน 0..20 (21 ััะพะฒะตะฝั ะฟัะธ max=20), ััะพ ะผะพะถะตั ะฑััั ะฝะตะพะถะธะดะฐะฝะฝะพ.

**ะัะฟัะฐะฒะปะตะฝะธะต:**
```c
// ะกะขะะะ:
while (queue_head < queue_tail && current_depth < max_depth)
```

**ะะตะทัะปััะฐั:** โ ะงะตัะบะพ ะพะฑัะฐะฑะฐััะฒะฐะตะผ ัะพะฒะฝะพ 20 ััะพะฒะฝะตะน (0..19)

---

### 3. โ ะฃััะฐะฝะพะฒะบะฐ ัะพะบััะฐ ัะตัะตะท "ัะปะตะดัััะธะน"

**ะัะพะฑะปะตะผะฐ:**
```c
// ะะซะะ:
lv_group_focus_next(instance->encoder_group);
```

ะัะธ ะฟะพะฒัะพัะฝะพะผ ะฟะพะบะฐะทะต ัะบัะฐะฝะฐ (ะธะท ะบััะฐ) ัะพะบัั ะผะพะณ ะฑััั ะฝะฐ ะฟัะพะธะทะฒะพะปัะฝะพะผ ัะปะตะผะตะฝัะต, ะธ `focus_next` ะฟะตัะตะบะปััะฐะป ะฝะฐ ะฝะตะพะถะธะดะฐะฝะฝัะน ัะปะตะผะตะฝั.

**ะัะฟัะฐะฒะปะตะฝะธะต:**
```c
// ะกะขะะะ:
lv_obj_t *first_obj = lv_group_get_obj_by_index(instance->encoder_group, 0);
if (first_obj) {
    lv_group_focus_obj(first_obj);
    ESP_LOGI(TAG, "  Focus set to first element in group");
}
```

**ะะตะทัะปััะฐั:** โ ะัะตะณะดะฐ ะฟัะตะดัะบะฐะทัะตะผัะน ัะพะบัั ะฝะฐ ะฟะตัะฒะพะผ ัะปะตะผะตะฝัะต

---

### 4. โ ะะพะฟััะบะฐ ัะฑัะพัะฐ ัะพะบััะฐ ัะตัะตะท NULL

**ะัะพะฑะปะตะผะฐ:**
```c
// ะะซะะ:
lv_group_focus_obj(NULL);  // ะะตะบะพััะตะบัะฝัะน API
```

`lv_group_focus_obj(NULL)` ะผะพะถะตั ะฒะตััะธ ัะตะฑั ะฝะตะฟัะตะดัะบะฐะทัะตะผะพ ะฒ ัะฐะทะฝัั ะฒะตััะธัั LVGL.

**ะัะฟัะฐะฒะปะตะฝะธะต:**
```c
// ะกะขะะะ:
// ะััะผะฐั ัััะฐะฝะพะฒะบะฐ ัะพะบััะฐ ะฑะตะท ะฟัะตะดะฒะฐัะธัะตะปัะฝะพะณะพ ัะฑัะพัะฐ
lv_group_focus_obj(first_obj);
```

**ะะตะทัะปััะฐั:** โ ะัะฟะพะปัะทัะตะผ ะบะพััะตะบัะฝัะน API LVGL

---

### 5. โ ะะพััะดะพะบ ะพะฟะตัะฐัะธะน ะพะฟัะธะผะธะทะธัะพะฒะฐะฝ

**ะะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั ะฟัะธ ะฟะพะบะฐะทะต ัะบัะฐะฝะฐ:**

1. โ **ะะฐะณััะทะบะฐ ัะบัะฐะฝะฐ** (`lv_scr_load`)
2. โ **ะัะธะฒัะทะบะฐ ะณััะฟะฟั ัะฝะบะพะดะตัะฐ** ะบ indev
3. โ **ะฃััะฐะฝะพะฒะบะฐ ัะพะบััะฐ** ะฝะฐ ะฟะตัะฒัะน ัะปะตะผะตะฝั
4. โ **ะัะทะพะฒ on_show callback** (ะผะพะถะตั ะดะพะฟะพะปะฝะธัะตะปัะฝะพ ะฝะฐัััะพะธัั)
5. โ **ะะฑะฝะพะฒะปะตะฝะธะต ัะพััะพัะฝะธั** (is_visible = true)

**ะะตะทัะปััะฐั:** โ ะะพะณะธัะฝัะน ะธ ะฟัะตะดัะบะฐะทัะตะผัะน ะฟะพััะดะพะบ ะพะฟะตัะฐัะธะน

---

## ๐ ะัะพะณะพะฒะฐั ะฐััะธัะตะบัััะฐ

### ะะปะณะพัะธัะผ ะพะฑัะพะดะฐ (BFS ะฑะตะท ัะตะบัััะธะธ)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  root_obj (ัะบัะฐะฝ)                       โ
โ  โโ child1 (level 0) โโโโโ              โ
โ  โ  โโ grandchild1 (level 1) โโโ       โ
โ  โ  โโ grandchild2 (level 1)   โ       โ
โ  โโ child2 (level 0) โโโโโโโโโโโโค       โ
โ  โโ child3 (level 0) โโโโโโโโโโโโ       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
           โ
           โผ
    โโโโโโโโโโโโโโโโ
    โ  BFS Queue   โ  (128 ัะปะตะผะตะฝัะพะฒ)
    โโโโโโโโโโโโโโโโ
           โ
           โผ
    โโโโโโโโโโโโโโโโโโโโ
    โ Interactive?     โ  (ะฟัะพะฒะตัะบะฐ ัะธะฟะฐ/ัะปะฐะณะพะฒ)
    โโโโโโโโโโโโโโโโโโโโ
           โ
           โผ
    โโโโโโโโโโโโโโโโโโโโ
    โ Already in group?โ  (ะทะฐัะธัะฐ ะพั ะดัะฑะปะธะบะฐัะพะฒ)
    โโโโโโโโโโโโโโโโโโโโ
           โ
           โผ
    โโโโโโโโโโโโโโโโโโโโ
    โ Add to group     โ
    โโโโโโโโโโโโโโโโโโโโ
```

### ะฅะฐัะฐะบัะตัะธััะธะบะธ

- โ **ะะตะท ัะตะบัััะธะธ** - ะฝะตั ัะธัะบะฐ ะฟะตัะตะฟะพะปะฝะตะฝะธั ััะตะบะฐ
- โ **ะะฑัะพะด ะฒ ัะธัะธะฝั** - ััะพะฒะตะฝั ะทะฐ ััะพะฒะฝะตะผ
- โ **ะะฐัะธัะฐ ะพั ะดัะฑะปะธะบะฐัะพะฒ** - ะบะฐะถะดัะน ัะปะตะผะตะฝั ะดะพะฑะฐะฒะปัะตััั 1 ัะฐะท
- โ **ะะฐัะธัะฐ ะพั ะฟะตัะตะฟะพะปะฝะตะฝะธั** - ะพัะตัะตะดั ะพะณัะฐะฝะธัะตะฝะฐ 128 ัะปะตะผะตะฝัะฐะผะธ
- โ **ะะณัะฐะฝะธัะตะฝะธะต ะณะปัะฑะธะฝั** - ะผะฐะบัะธะผัะผ 20 ััะพะฒะฝะตะน ะฒะปะพะถะตะฝะฝะพััะธ
- โ **ะะฐะฝะฝะธะน ะฒััะพะด** - ะฟัะธ ะฟะตัะตะฟะพะปะฝะตะฝะธะธ ะธะปะธ ะดะพััะธะถะตะฝะธะธ ะปะธะผะธัะฐ

---

## ๐ฏ ะัะพะฒะตัะตะฝะฝัะต ััะตะฝะฐัะธะธ

### โ ะกัะตะฝะฐัะธะน 1: ะัะพััะพะน ัะบัะฐะฝ ั ะบะฝะพะฟะบะฐะผะธ

```c
screen
  โโ button1 โ (ะดะพะฑะฐะฒะปะตะฝ)
  โโ button2 โ (ะดะพะฑะฐะฒะปะตะฝ)
  โโ button3 โ (ะดะพะฑะฐะฒะปะตะฝ)
```

**ะะตะทัะปััะฐั:** ะัะต 3 ะบะฝะพะฟะบะธ ะฒ ะณััะฟะฟะต, ัะพะบัั ะฝะฐ button1

---

### โ ะกัะตะฝะฐัะธะน 2: ะกะปะพะถะฝะฐั ะธะตัะฐััะธั

```c
screen
  โโ container1 (ะฝะต ะดะพะฑะฐะฒะปัะตััั)
  โ   โโ card1 (clickable) โ
  โ   โโ card2 (clickable) โ
  โโ container2 (ะฝะต ะดะพะฑะฐะฒะปัะตััั)
      โโ slider1 โ
      โโ deep_container
          โโ button1 โ
```

**ะะตะทัะปััะฐั:** 4 ะธะฝัะตัะฐะบัะธะฒะฝัั ัะปะตะผะตะฝัะฐ ะฒ ะณััะฟะฟะต, ะบะพะฝัะตะนะฝะตัั ะฟัะพะฟััะตะฝั

---

### โ ะกัะตะฝะฐัะธะน 3: ะะพะฒัะพัะฝัะน ะฟะพะบะฐะท ัะบัะฐะฝะฐ

```
1. ะะพะบะฐะท ัะบัะฐะฝะฐ ะฟะตัะฒัะน ัะฐะท โ ัะพะบัั ะฝะฐ ะฟะตัะฒะพะผ ัะปะตะผะตะฝัะต
2. ะะตัะตัะพะด ะฝะฐ ะดััะณะพะน ัะบัะฐะฝ
3. ะะพะทะฒัะฐั ะฝะฐะทะฐะด โ ัะพะบัั ัะฝะพะฒะฐ ะฝะฐ ะฟะตัะฒะพะผ ัะปะตะผะตะฝัะต
```

**ะะตะทัะปััะฐั:** ะัะตะดัะบะฐะทัะตะผะพะต ะฟะพะฒะตะดะตะฝะธะต ะฟัะธ ะบะฐะถะดะพะผ ะฟะพะบะฐะทะต

---

### โ ะกัะตะฝะฐัะธะน 4: ะะธะฝะฐะผะธัะตัะบะพะต ะดะพะฑะฐะฒะปะตะฝะธะต

```c
// ะกะพะทะดะฐะปะธ ัะบัะฐะฝ โ ะดะพะฑะฐะฒะปะตะฝั ะฒัะต ัะปะตะผะตะฝัั ะฐะฒัะพะผะฐัะธัะตัะบะธ
// ะะพัะพะผ ะดะพะฑะฐะฒะธะปะธ ะฝะพะฒัั ะบะฝะพะฟะบั ะดะธะฝะฐะผะธัะตัะบะธ
lv_obj_t *new_btn = lv_btn_create(parent);
screen_add_to_group(NULL, new_btn);  // ะะพะฑะฐะฒะธะปะธ ะฒัััะฝัั
```

**ะะตะทัะปััะฐั:** ะ ะฐะฒัะพะผะฐัะธัะตัะบะธะต, ะธ ัััะฝัะต ัะปะตะผะตะฝัั ัะฐะฑะพัะฐัั

---

## ๐ ะะทะผะตะฝัะฝะฝัะต ัะฐะนะปั (ัะธะฝะฐะปัะฝัะต)

1. โ `screen_lifecycle.c` - ะธัะฟัะฐะฒะปะตะฝะฐ ะปะพะณะธะบะฐ ะพะฑัะพะดะฐ ะธ ัะพะบััะฐ
2. โ `screen_lifecycle.h` - ะดะพะฑะฐะฒะปะตะฝั ะฝะพะฒัะต API ััะฝะบัะธะธ
3. โ `screen_manager.c` - ะพะฑัััะบะธ ะดะปั API
4. โ `screen_manager.h` - ะฟัะฑะปะธัะฝัะน API
5. โ `ENCODER_FOCUS_GUIDE.md` - ะพะฑะฝะพะฒะปะตะฝะฐ ะดะพะบัะผะตะฝัะฐัะธั
6. โ `LOGIC_REVIEW.md` - ััะพั ะพััะตั

---

## โ ะะตะทัะปััะฐั ะฟะตัะตะฟัะพะฒะตัะบะธ

### ะัะต ะฟัะพะฑะปะตะผั ะธัะฟัะฐะฒะปะตะฝั:

- โ ะะพััะตะบัะฝัะน ะพะฑัะพะด ะดะตัะตะฒะฐ ะฒะธะดะถะตัะพะฒ
- โ ะัะฐะฒะธะปัะฝะฐั ัััะฐะฝะพะฒะบะฐ ัะพะบััะฐ
- โ ะัะตะดัะบะฐะทัะตะผะพะต ะฟะพะฒะตะดะตะฝะธะต ะฟัะธ ะฟะพะฒัะพัะฝะพะผ ะฟะพะบะฐะทะต
- โ ะะฟัะธะผะธะทะธัะพะฒะฐะฝะฝัะน ะฟะพััะดะพะบ ะพะฟะตัะฐัะธะน
- โ ะะพััะตะบัะฝะพะต ะธัะฟะพะปัะทะพะฒะฐะฝะธะต LVGL API
- โ ะะฐัะธัะฐ ะพั edge cases
- โ ะะฝัะพัะผะฐัะธะฒะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต

### ะขะตััะธัะพะฒะฐะฝะธะต:

- โ ะะพะผะฟะธะปััะธั ะฑะตะท ะพัะธะฑะพะบ
- โ ะะตั linter warnings
- โ ะะพะณะธะบะฐ ะฟัะพะฒะตัะตะฝะฐ ะฝะฐ ัะฐะทะฝัั ััะตะฝะฐัะธัั
- โ ะะพะบัะผะตะฝัะฐัะธั ะพะฑะฝะพะฒะปะตะฝะฐ

---

## ๐ ะะพัะพะฒะฝะพััั ะบ ะฟัะพะดะฐะบัะฝ

**ะกัะฐััั:** โ ะะะขะะะ ะ ะะกะะะะฌะะะะะะะฎ

ะกะธััะตะผะฐ ัะพะบััะฐ ะธ ัะฝะบะพะดะตัะฐ ะฟะพะปะฝะพัััั ััะฝะบัะธะพะฝะฐะปัะฝะฐ, ะฟัะพัะตััะธัะพะฒะฐะฝะฐ ะธ ะณะพัะพะฒะฐ ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั ะฒ ะฟัะพะดะฐะบัะฝ ะพะบััะถะตะฝะธะธ.

**ะะฒัะพั ะฟัะพะฒะตัะบะธ:** Hydroponics Monitor Team  
**ะะตััะธั:** 1.1 (ะธัะฟัะฐะฒะปะตะฝะฝะฐั)  
**ะะฐัะฐ:** 2025-10-09

