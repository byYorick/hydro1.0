# –°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ (Error Handler)

## –û–ø–∏—Å–∞–Ω–∏–µ

–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤—ã–≤–æ–¥–æ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–∞ —ç–∫—Ä–∞–Ω —á–µ—Ä–µ–∑ LVGL.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ **–ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è** –æ—à–∏–±–æ–∫ –ø–æ —Ç–∏–ø–∞–º (I2C, –¥–∞—Ç—á–∏–∫–∏, –¥–∏—Å–ø–ª–µ–π, –∏ —Ç.–¥.)
- ‚úÖ **–£—Ä–æ–≤–Ω–∏ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏** (Debug, Info, Warning, Error, Critical)
- ‚úÖ **–í—Å–ø–ª—ã–≤–∞—é—â–∏–µ –æ–∫–Ω–∞** –Ω–∞ —ç–∫—Ä–∞–Ω–µ —Å —Ü–≤–µ—Ç–æ–≤–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–µ–π
- ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** —Å —Å–∏—Å—Ç–µ–º–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** –ø–æ –æ—à–∏–±–∫–∞–º
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** —á–µ—Ä–µ–∑ ESP_LOG

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

```c
#include "error_handler.h"

// –û–±—ä—è–≤–ª–µ–Ω–∏–µ —Ä—É—Å—Å–∫–æ–≥–æ —à—Ä–∏—Ñ—Ç–∞ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
LV_FONT_DECLARE(montserrat_ru);

void app_main(void) {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º–∏ –≤—Å–ø–ª—ã–≤–∞—é—â–∏–º–∏ –æ–∫–Ω–∞–º–∏
    error_handler_init(true);
    
    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä—É—Å—Å–∫–æ–≥–æ —à—Ä–∏—Ñ—Ç–∞ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∫–∏—Ä–∏–ª–ª–∏—Ü—ã
    error_handler_set_font(&montserrat_ru);
}
```

**–í–∞–∂–Ω–æ:** –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä—É—Å—Å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —à—Ä–∏—Ñ—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–∏—Ä–∏–ª–ª–∏—Ü—ã (Unicode –¥–∏–∞–ø–∞–∑–æ–Ω 0x400-0x4FF)
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —à—Ä–∏—Ñ—Ç —á–µ—Ä–µ–∑ `error_handler_set_font()` –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
3. –®—Ä–∏—Ñ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—ä—è–≤–ª–µ–Ω —á–µ—Ä–µ–∑ `LV_FONT_DECLARE()` –∏ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω –≤ –ø—Ä–æ–µ–∫—Ç

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```c
#include "error_handler.h"

// –û—Ç—á–µ—Ç –æ–± –æ—à–∏–±–∫–µ
error_handler_report(
    ERROR_CATEGORY_SENSOR,      // –ö–∞—Ç–µ–≥–æ—Ä–∏—è
    ERROR_LEVEL_ERROR,          // –£—Ä–æ–≤–µ–Ω—å
    ESP_ERR_TIMEOUT,           // –ö–æ–¥ –æ—à–∏–±–∫–∏
    "SHT3X",                   // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç
    "–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å –¥–∞—Ç—á–∏–∫–∞"
);
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∞–∫—Ä–æ—Å–æ–≤ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```c
// –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
ERROR_WARN(ERROR_CATEGORY_I2C, "i2c_bus", 
          "–ú–µ–¥–ª–µ–Ω–Ω—ã–π –æ—Ç–∫–ª–∏–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ 0x%02X", device_addr);

// –û—à–∏–±–∫–∞ —Å –∫–æ–¥–æ–º
ERROR_REPORT(ERROR_CATEGORY_SENSOR, err, "SHT3X", 
            "–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã");

// –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞
ERROR_CRITICAL(ERROR_CATEGORY_SYSTEM, ESP_ERR_NO_MEM, "MAIN", 
              "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞–º—è—Ç–∏ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏");

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ I2C
esp_err_t err = i2c_master_transmit(...);
ERROR_CHECK_I2C(err, "i2c_bus", "–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –Ω–∞ 0x%02X", addr);

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –¥–∞—Ç—á–∏–∫–∞
esp_err_t err = sht3x_read_temperature(...);
ERROR_CHECK_SENSOR(err, "SHT3X", "–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É");
```

## –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—à–∏–±–æ–∫

- `ERROR_CATEGORY_I2C` - –û—à–∏–±–∫–∏ —à–∏–Ω—ã I2C
- `ERROR_CATEGORY_SENSOR` - –û—à–∏–±–∫–∏ –¥–∞—Ç—á–∏–∫–æ–≤
- `ERROR_CATEGORY_DISPLAY` - –û—à–∏–±–∫–∏ –¥–∏—Å–ø–ª–µ—è
- `ERROR_CATEGORY_STORAGE` - –û—à–∏–±–∫–∏ NVS
- `ERROR_CATEGORY_SYSTEM` - –°–∏—Å—Ç–µ–º–Ω—ã–µ –æ—à–∏–±–∫–∏
- `ERROR_CATEGORY_PUMP` - –û—à–∏–±–∫–∏ –Ω–∞—Å–æ—Å–æ–≤
- `ERROR_CATEGORY_RELAY` - –û—à–∏–±–∫–∏ —Ä–µ–ª–µ
- `ERROR_CATEGORY_CONTROLLER` - –û—à–∏–±–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤
- `ERROR_CATEGORY_NETWORK` - –°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏
- `ERROR_CATEGORY_OTHER` - –ü—Ä–æ—á–∏–µ

## –£—Ä–æ–≤–Ω–∏ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏

- `ERROR_LEVEL_DEBUG` - –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —ç–∫—Ä–∞–Ω–µ)
- `ERROR_LEVEL_INFO` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —ç–∫—Ä–∞–Ω–µ)
- `ERROR_LEVEL_WARNING` - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, –æ—Ä–∞–Ω–∂–µ–≤—ã–π —Ü–≤–µ—Ç)
- `ERROR_LEVEL_ERROR` - –û—à–∏–±–∫–∞ (–≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ, –∫—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç)
- `ERROR_LEVEL_CRITICAL` - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ (–≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ –Ω–∞ 10 —Å–µ–∫, —Ç–µ–º–Ω–æ-–∫—Ä–∞—Å–Ω—ã–π)

## –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è

- üîµ **–°–∏–Ω–∏–π** - Debug/Info
- üü¢ **–ó–µ–ª–µ–Ω—ã–π** - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- üü† **–û—Ä–∞–Ω–∂–µ–≤—ã–π** - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
- üî¥ **–ö—Ä–∞—Å–Ω—ã–π** - –û—à–∏–±–∫–∞
- üî¥ **–¢–µ–º–Ω–æ-–∫—Ä–∞—Å–Ω—ã–π** - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

```c
uint32_t total, critical, errors, warnings;
error_handler_get_stats(&total, &critical, &errors, &warnings);

ESP_LOGI(TAG, "–í—Å–µ–≥–æ –æ—à–∏–±–æ–∫: %lu", total);
ESP_LOGI(TAG, "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö: %lu", critical);
ESP_LOGI(TAG, "–û—à–∏–±–æ–∫: %lu", errors);
ESP_LOGI(TAG, "–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π: %lu", warnings);

// –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
error_handler_clear_stats();
```

## –ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

```c
#include "error_handler.h"

static const char *TAG = "MY_COMPONENT";

esp_err_t my_component_init(void) {
    esp_err_t err;
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —à–∏–Ω—ã I2C
    err = i2c_bus_init();
    if (err != ESP_OK) {
        ERROR_CRITICAL(ERROR_CATEGORY_I2C, err, TAG, 
                      "–ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å I2C");
        return err;
    }
    
    // –ß—Ç–µ–Ω–∏–µ –¥–∞—Ç—á–∏–∫–∞
    float value;
    err = sensor_read(&value);
    if (err == ESP_ERR_TIMEOUT) {
        ERROR_WARN(ERROR_CATEGORY_SENSOR, TAG, 
                  "–¢–∞–π–º–∞—É—Ç —á—Ç–µ–Ω–∏—è –¥–∞—Ç—á–∏–∫–∞ (–ø–æ–ø—ã—Ç–∫–∞ %d)", retry_count);
    } else if (err != ESP_OK) {
        ERROR_REPORT(ERROR_CATEGORY_SENSOR, err, TAG, 
                    "–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –¥–∞—Ç—á–∏–∫–∞");
    }
    
    return ESP_OK;
}
```

## Callback –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

```c
void my_error_callback(const error_info_t *error) {
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
    if (error->level == ERROR_LEVEL_CRITICAL) {
        // –ù–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
        component_restart();
    }
}

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è callback
error_handler_register_callback(my_error_callback);
```

## –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –≤—Å–ø–ª—ã–≤–∞—é—â–∏—Ö –æ–∫–æ–Ω

```c
// –û—Ç–∫–ª—é—á–∏—Ç—å –≤—Å–ø–ª—ã–≤–∞—é—â–∏–µ –æ–∫–Ω–∞
error_handler_set_popup(false);

// –í–∫–ª—é—á–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ
error_handler_set_popup(true);
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å:
- **notification_system** - –≤—Å–µ –æ—à–∏–±–∫–∏ —É—Ä–æ–≤–Ω—è WARNING –∏ –≤—ã—à–µ —Å–æ–∑–¥–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- **LVGL** - –æ—à–∏–±–∫–∏ —É—Ä–æ–≤–Ω—è ERROR –∏ –≤—ã—à–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤—Å–ø–ª—ã–≤–∞—é—â–∏–º–∏ –æ–∫–Ω–∞–º–∏
- **ESP_LOG** - –≤—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- `notification_system`
- `lvgl`
- `freertos`

## –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

```
E (12345) SHT3X: [SENSOR] –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É (code: 263)
```

–ù–∞ —ç–∫—Ä–∞–Ω–µ –ø–æ—è–≤–∏—Ç—Å—è –∫—Ä–∞—Å–Ω–æ–µ –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ:
```
–û–®–ò–ë–ö–ê

SHT3X: –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É

–ö–æ–¥: 263 (ESP_ERR_TIMEOUT)
```

## –ö–æ–¥—ã –æ—à–∏–±–æ–∫ - –ö—Ä–∞—Ç–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞

### –ù–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏:

| –ö–æ–¥ | –ù–∞–∑–≤–∞–Ω–∏–µ | –¢–∏–ø–∏—á–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ | –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ |
|-----|----------|------------------|-----------------|
| **0** | ESP_OK | –£—Å–ø–µ—Ö | ‚Äî |
| **-1** | ESP_FAIL | –û–±—â–∞—è –æ—à–∏–±–∫–∞ | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã |
| **257** | ESP_ERR_NO_MEM | –ù–µ—Ç –ø–∞–º—è—Ç–∏ | –û—Å–≤–æ–±–æ–¥–∏—Ç–µ heap –∏–ª–∏ —É–≤–µ–ª–∏—á—å—Ç–µ —Ä–∞–∑–º–µ—Ä |
| **258** | ESP_ERR_INVALID_ARG | –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã —Ñ—É–Ω–∫—Ü–∏–∏ |
| **259** | ESP_ERR_INVALID_STATE | –ù–µ–≤–µ—Ä–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—è–¥–æ–∫ –≤—ã–∑–æ–≤–æ–≤ |
| **263** | ESP_ERR_TIMEOUT | –¢–∞–π–º–∞—É—Ç | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ/—Å–µ—Ç—å |
| **265** | ESP_ERR_INVALID_CRC | –û—à–∏–±–∫–∞ CRC | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤—è–∑—å, –ø–æ–º–µ—Ö–∏ |

### –û—à–∏–±–∫–∏ I2C:

| –ö–æ–¥ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|-----|---------|---------|
| 263 | –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥—Ä–µ—Å, –ø–∏—Ç–∞–Ω–∏–µ, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ |
| 265 | –ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö | –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ pull-up —Ä–µ–∑–∏—Å—Ç–æ—Ä—ã, –∫–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–æ–≤–æ–¥–∞ |

### –û—à–∏–±–∫–∏ NVS:

| –ö–æ–¥ | –ù–∞–∑–≤–∞–Ω–∏–µ | –†–µ—à–µ–Ω–∏–µ |
|-----|----------|---------|
| 4354 | –ù–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ | –í—ã–∑–æ–≤–∏—Ç–µ nvs_flash_init() |
| 4355 | –ö–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω | –°–æ–∑–¥–∞–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| 4358 | –ù–µ—Ç –º–µ—Å—Ç–∞ | –û—á–∏—Å—Ç–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ —É–≤–µ–ª–∏—á—å—Ç–µ —Ä–∞–∑–¥–µ–ª |

üìñ **–ü–æ–ª–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞**: –°–º. [ERROR_CODES_RU.md](ERROR_CODES_RU.md) –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –≤—Å–µ—Ö –∫–æ–¥–æ–≤ –æ—à–∏–±–æ–∫

## –ü—Ä–∏–º–µ—Ä—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫

### I2C —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç:
```c
esp_err_t err = i2c_master_transmit(handle, data, len, 1000);
if (err == ESP_ERR_TIMEOUT) {
    ERROR_CHECK_I2C(err, "SHT3X", 
                   "–î–∞—Ç—á–∏–∫ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: "
                   "1) –ü–∏—Ç–∞–Ω–∏–µ (2.4-5.5V) "
                   "2) I2C –∞–¥—Ä–µ—Å (0x44/0x45) "
                   "3) –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ SDA/SCL");
    // –ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    sensor_reset();
}
```

### –ù–µ—Ö–≤–∞—Ç–∫–∞ –ø–∞–º—è—Ç–∏:
```c
char *buffer = malloc(size);
if (buffer == NULL) {
    ERROR_CRITICAL(ERROR_CATEGORY_SYSTEM, ESP_ERR_NO_MEM, TAG,
                  "–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–¥–µ–ª–∏—Ç—å %d –±–∞–π—Ç. "
                  "–°–≤–æ–±–æ–¥–Ω–æ heap: %d –±–∞–π—Ç", 
                  size, esp_get_free_heap_size());
    // –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Ç—É–∞—Ü–∏—è - –æ—Å–≤–æ–±–æ–∂–¥–∞–µ–º –∫—ç—à–∏
    clear_caches();
    return ESP_ERR_NO_MEM;
}
```

### –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ:
```c
#define MAX_RETRIES 3
int retry = 0;
esp_err_t err;

do {
    err = sensor_read(&value);
    if (err == ESP_OK) break;
    
    if (err == ESP_ERR_TIMEOUT) {
        ERROR_WARN(ERROR_CATEGORY_SENSOR, TAG,
                  "–ü–æ–ø—ã—Ç–∫–∞ %d/%d: –¢–∞–π–º–∞—É—Ç —á—Ç–µ–Ω–∏—è –¥–∞—Ç—á–∏–∫–∞",
                  retry + 1, MAX_RETRIES);
        vTaskDelay(pdMS_TO_TICKS(100)); // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–æ–º
    } else {
        // –î—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞ - –ø—Ä–µ—Ä—ã–≤–∞–µ–º –ø–æ–ø—ã—Ç–∫–∏
        ERROR_REPORT(ERROR_CATEGORY_SENSOR, err, TAG,
                    "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –¥–∞—Ç—á–∏–∫–∞");
        break;
    }
} while (++retry < MAX_RETRIES);

if (err != ESP_OK) {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–≤–µ—Å—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    value = last_valid_value;
}
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- üìñ **[–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∫–æ–¥–æ–≤ –æ—à–∏–±–æ–∫ (ERROR_CODES_RU.md)](ERROR_CODES_RU.md)** - –ü–æ–ª–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –≤—Å–µ—Ö –∫–æ–¥–æ–≤ —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏
- [ESP-IDF Error Codes](https://docs.espressif.com/projects/esp-idf/en/latest/esp32s3/api-reference/error-codes.html)
- [FreeRTOS Documentation](https://www.freertos.org/Documentation/)
- [I2C Specification](https://www.nxp.com/docs/en/user-guide/UM10204.pdf)

