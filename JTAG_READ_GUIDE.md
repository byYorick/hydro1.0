# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —á—Ç–µ–Ω–∏—é ESP32-S3 —á–µ—Ä–µ–∑ JTAG

**–î–∞—Ç–∞:** 2025-10-09  
**–ó–∞–¥–∞—á–∞:** –ß—Ç–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏, —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ –∏ flash ESP32-S3 —á–µ—Ä–µ–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π USB-JTAG

---

## üéØ –ß–¢–û –ú–û–ñ–ù–û –ü–†–û–ß–ò–¢–ê–¢–¨

‚úÖ **RAM** - –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–º—è—Ç—å (DRAM, IRAM)  
‚úÖ **Flash** - —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–ª–µ—à-–ø–∞–º—è—Ç–∏  
‚úÖ **–†–µ–≥–∏—Å—Ç—Ä—ã** - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞  
‚úÖ **–ü–µ—Ä–∏—Ñ–µ—Ä–∏—è** - —Ä–µ–≥–∏—Å—Ç—Ä—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (I2C, SPI, GPIO, etc)  
‚úÖ **Stack/Heap** - —Å—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –ø–∞–º—è—Ç—å  

---

## üöÄ –¢–†–ò –°–ü–û–°–û–ë–ê –ß–¢–ï–ù–ò–Ø

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ –≥–æ—Ç–æ–≤—ã–π Python —Å–∫—Ä–∏–ø—Ç (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

```bash
python read_esp32_memory.py
```

**–ú–µ–Ω—é —Å–∫—Ä–∏–ø—Ç–∞:**
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∏–ø–µ
- –ß—Ç–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞
- –ß—Ç–µ–Ω–∏–µ RAM/IRAM
- –î–∞–º–ø Flash
- –û—Å—Ç–∞–Ω–æ–≤–∫–∞/–∑–∞–ø—É—Å–∫ —á–∏–ø–∞
- –ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã OpenOCD

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ OpenOCD
- –£–¥–æ–±–Ω—ã–π –≤—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

---

### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ bat-—Å–∫—Ä–∏–ø—Ç

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —á—Ç–µ–Ω–∏–µ:
read_jtag.bat

# –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º:
jtag_interactive.bat
```

`jtag_interactive.bat` –∑–∞–ø—É—Å—Ç–∏—Ç OpenOCD —Å–µ—Ä–≤–µ—Ä, –ø–æ—Å–ª–µ —á–µ–≥–æ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ telnet:

```bash
telnet localhost 4444
```

---

### –°–ø–æ—Å–æ–± 3: –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ OpenOCD

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ OpenOCD –≤ –æ–¥–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:
openocd -f board/esp32s3-builtin.cfg

# 2. –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å:
telnet localhost 4444

# 3. –í—ã–ø–æ–ª–Ω—è–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã (—Å–º. –Ω–∏–∂–µ)
```

---

## üìã –ü–û–õ–ï–ó–ù–´–ï –ö–û–ú–ê–ù–î–´ OPENOCD

### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∏–ø–µ
```
> esp chip_info
```

### –ß—Ç–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞
```
> reg                    # –í—Å–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã
> reg pc                 # Program Counter
> reg sp                 # Stack Pointer
```

### –ß—Ç–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏

**–§–æ—Ä–º–∞—Ç—ã:**
- `mdb` - byte (8 –±–∏—Ç)
- `mdh` - halfword (16 –±–∏—Ç)
- `mdw` - word (32 –±–∏—Ç–∞)

**–ü—Ä–∏–º–µ—Ä—ã:**
```
> mdw 0x3FC88000 32      # 32 —Å–ª–æ–≤–∞ –∏–∑ DRAM
> mdb 0x40370000 256     # 256 –±–∞–π—Ç –∏–∑ IRAM
> mdw 0x60000000 16      # –ß–∏—Ç–∞–µ–º —Ä–µ–≥–∏—Å—Ç—Ä—ã GPIO
```

### –í–∞–∂–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ ESP32-S3

| –û–±–ª–∞—Å—Ç—å | –ê–¥—Ä–µ—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-------|----------|
| **DRAM** | `0x3FC88000` - `0x3FD00000` | –û–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–º—è—Ç—å –¥–∞–Ω–Ω—ã—Ö |
| **IRAM** | `0x40370000` - `0x403E0000` | –ü–∞–º—è—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π |
| **ROM** | `0x40000000` - `0x40060000` | Boot ROM |
| **Flash** | `0x42000000` - ... | –ú–∞–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω–∞—è Flash |
| **RTC FAST** | `0x600FE000` | RTC –±—ã—Å—Ç—Ä–∞—è –ø–∞–º—è—Ç—å |
| **RTC SLOW** | `0x50000000` | RTC –º–µ–¥–ª–µ–Ω–Ω–∞—è –ø–∞–º—è—Ç—å |

### –ü–µ—Ä–∏—Ñ–µ—Ä–∏—è (–ø—Ä–∏–º–µ—Ä—ã)

```
> mdw 0x60004000 16      # GPIO —Ä–µ–≥–∏—Å—Ç—Ä—ã
> mdw 0x60013000 16      # I2C0 —Ä–µ–≥–∏—Å—Ç—Ä—ã
> mdw 0x60024000 16      # I2C1 —Ä–µ–≥–∏—Å—Ç—Ä—ã
> mdw 0x3FF43000 16      # SPI2 —Ä–µ–≥–∏—Å—Ç—Ä—ã
```

### –î–∞–º–ø Flash –≤ —Ñ–∞–π–ª
```
> flash read_bank 0 bootloader.bin 0x0 0x10000        # Bootloader
> flash read_bank 0 partition.bin 0x8000 0x1000       # Partition table
> flash read_bank 0 app.bin 0x10000 0x200000          # Application
> flash read_bank 0 full_dump.bin 0x0 0x1000000       # –í—Å—è flash (16MB)
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º
```
> reset halt             # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–∏–ø
> reset run              # –ó–∞–ø—É—Å—Ç–∏—Ç—å —á–∏–ø
> halt                   # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
> resume                 # –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
> step                   # –í—ã–ø–æ–ª–Ω–∏—Ç—å –æ–¥–Ω—É –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
```

### –¢–æ—á–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–∞
```
> bp 0x40380000 4 hw     # Hardware breakpoint
> rbp 0x40380000         # –£–¥–∞–ª–∏—Ç—å breakpoint
```

---

## üîç –ü–†–ê–ö–¢–ò–ß–ï–°–ö–ò–ï –ü–†–ò–ú–ï–†–´

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
```bash
python read_esp32_memory.py
# –í—ã–±—Ä–∞—Ç—å: 1 (–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∏–ø–µ)
```

### 2. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤ –ø—Ä–∏ –∫—Ä–∞—à–µ
```bash
# –í telnet –∫ OpenOCD:
> reset halt
> reg pc                 # –ê–¥—Ä–µ—Å —Ç–µ–∫—É—â–µ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
> reg sp                 # –£–∫–∞–∑–∞—Ç–µ–ª—å —Å—Ç–µ–∫–∞
> mdw [SP] 64           # –î–∞–º–ø —Å—Ç–µ–∫–∞
```

### 3. –ü—Ä–æ—á–∏—Ç–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –∏–∑ RAM
```bash
# –ï—Å–ª–∏ –∑–Ω–∞–µ—Ç–µ –∞–¥—Ä–µ—Å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π (–∏–∑ .map —Ñ–∞–π–ª–∞):
> mdw 0x3FC88ABC 1      # –ß–∏—Ç–∞–µ–º 1 —Å–ª–æ–≤–æ
```

### 4. –î–∞–º–ø –≤—Å–µ–π Flash –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
```bash
python read_esp32_memory.py
# –í—ã–±—Ä–∞—Ç—å: 5 (–î–∞–º–ø Flash)
# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
> flash read_bank 0 full_flash.bin 0 0x1000000
```

### 5. –û—Ç–ª–∞–¥–∫–∞ –∑–∞–≤–∏—Å–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã
```bash
# 1. –ï—Å–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–∏—Å–ª–∞:
> halt                   # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º

# 2. –°–º–æ—Ç—Ä–∏–º –≥–¥–µ –∑–∞—Å—Ç—Ä—è–ª–∞:
> reg pc                 # –¢–µ–∫—É—â–∏–π –∞–¥—Ä–µ—Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

# 3. –°–º–æ—Ç—Ä–∏–º —Å—Ç–µ–∫:
> reg sp
> mdw [–∞–¥—Ä–µ—Å SP] 64

# 4. –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ:
> resume
```

---

## üêõ –û–¢–õ–ê–î–ö–ê –ß–ï–†–ï–ó GDB + JTAG

### –ó–∞–ø—É—Å–∫ GDB —Å–µ—Å—Å–∏–∏

```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ OpenOCD
openocd -f board/esp32s3-builtin.cfg

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: –ó–∞–ø—É—Å—Ç–∏—Ç–µ GDB
xtensa-esp32s3-elf-gdb build/hydroponics.elf

# –í GDB:
(gdb) target remote localhost:3333
(gdb) monitor reset halt
(gdb) b app_main          # Breakpoint –Ω–∞ app_main
(gdb) c                   # Continue
```

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã GDB
```gdb
(gdb) bt                  # Backtrace - —Å—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤
(gdb) info locals         # –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
(gdb) p variable_name     # –ü–µ—á–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
(gdb) x/32xw 0x3FC88000   # –î–∞–º–ø –ø–∞–º—è—Ç–∏
(gdb) info threads        # –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á FreeRTOS
(gdb) thread 2            # –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –∑–∞–¥–∞—á—É
```

---

## üìä –ê–ù–ê–õ–ò–ó –î–ê–ú–ü–ê –ü–ê–ú–Ø–¢–ò

–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–º–ø–∞ –º–æ–∂–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å:

### 1. –ß–µ—Ä–µ–∑ hexdump (Linux/Git Bash)
```bash
hexdump -C flash_dump.bin | less
```

### 2. –ß–µ—Ä–µ–∑ Python
```python
with open('flash_dump.bin', 'rb') as f:
    data = f.read()
    # –ò—â–µ–º —Å—Ç—Ä–æ–∫–∏
    for i in range(len(data) - 3):
        if data[i:i+4] == b'WiFi':
            print(f"Found at offset: 0x{i:X}")
```

### 3. –ß–µ—Ä–µ–∑ objdump (–¥–ª—è .elf)
```bash
xtensa-esp32s3-elf-objdump -S build/hydroponics.elf > disassembly.txt
```

---

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

1. **–ù–µ —á–∏—Ç–∞–π—Ç–µ –≤–æ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏** - –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —á–∏–ø (`reset halt`)
2. **Flash mapping** - –∞–¥—Ä–µ—Å–∞ 0x42000000+ —ç—Ç–æ MMU-–º–∞–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω–∞—è flash
3. **Alignment** - –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∞–¥—Ä–µ—Å–∞ —Ç—Ä–µ–±—É—é—Ç –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è (word-aligned)
4. **Cache** - –¥–∞–Ω–Ω—ã–µ –≤ –∫–µ—à–µ –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç RAM
5. **RTC –ø–∞–º—è—Ç—å** - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ deep sleep

---

## üéØ –†–ï–ó–Æ–ú–ï

**–£ –≤–∞—Å –µ—Å—Ç—å —Ç—Ä–∏ —Å–ø–æ—Å–æ–±–∞:**

1. **–ë—ã—Å—Ç—Ä–æ –∏ –ø—Ä–æ—Å—Ç–æ:** `python read_esp32_memory.py`
2. **–ü–∞–∫–µ—Ç–Ω–æ–µ —á—Ç–µ–Ω–∏–µ:** `read_jtag.bat`
3. **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞:** `jtag_interactive.bat` + telnet

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
- `esp chip_info` - –∏–Ω—Ñ–æ –æ —á–∏–ø–µ
- `mdw 0xADDRESS 32` - —á–∏—Ç–∞—Ç—å –ø–∞–º—è—Ç—å
- `flash read_bank 0 file.bin 0 SIZE` - –¥–∞–º–ø flash
- `reg` - —Ä–µ–≥–∏—Å—Ç—Ä—ã –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞

**–î–ª—è –æ—Ç–ª–∞–¥–∫–∏:**
- OpenOCD + GDB = –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞
- –¢–æ—á–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–∞, —à–∞–≥–∏, —Å—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤

---

## üìû –ù–£–ñ–ù–ê –ü–û–ú–û–©–¨?

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å —á—Ç–æ-—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ:
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `python read_esp32_memory.py`
2. –í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏—é 9 (–ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å)
3. –ò–ª–∏ –æ–ø—Ü–∏—é 8 (—Å–≤–æ—è –∫–æ–º–∞–Ω–¥–∞ OpenOCD)

–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏—Ç–µ —á—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å, –∏ —è –ø–æ–º–æ–≥—É! üöÄ

