# 🎯 Память ESP32-S3: Краткая справка

## 📊 Визуальная схема

```
╔═══════════════════════════════════════════════════════════════╗
║                      ESP32-S3 ПАМЯТЬ                          ║
╠═══════════════════════════════════════════════════════════════╣
║                                                               ║
║   🚀 SRAM (внутренняя) - БЫСТРАЯ                             ║
║   ┌─────────────────────────────────────────────────────┐    ║
║   │  IRAM (код ISR, WiFi)          16 KB  [████████]    │    ║
║   │  DRAM (данные, heap, stack)   230 KB  [████████░░]  │    ║
║   │  Cache                         64 KB  [████████]    │    ║
║   └─────────────────────────────────────────────────────┘    ║
║                                                               ║
║   🐌 PSRAM (внешняя) - МЕДЛЕННАЯ, НО МНОГО                   ║
║   ┌─────────────────────────────────────────────────────┐    ║
║   │  LVGL буферы                   ~57 KB               │    ║
║   │  WiFi буферы                   ~10 KB               │    ║
║   │  Свободно                      ~1.8-7.8 MB          │    ║
║   └─────────────────────────────────────────────────────┘    ║
║                                                               ║
║   📀 FLASH - ТОЛЬКО ЧТЕНИЕ                                   ║
║   ┌─────────────────────────────────────────────────────┐    ║
║   │  Код программы (.text)         ~540 KB              │    ║
║   │  Константы (.rodata)           ~213 KB              │    ║
║   │  NVS (настройки)               24 KB                │    ║
║   │  Свободно                      2.6 MB               │    ║
║   └─────────────────────────────────────────────────────┘    ║
║                                                               ║
╚═══════════════════════════════════════════════════════════════╝
```

---

## 🎯 Что куда идет?

### ⚡ В DRAM (быстро, мало места):
```c
✅ static sensor_data_t cache;           // Маленькие структуры
✅ FreeRTOS стеки задач                   // Стеки
✅ WiFi driver буферы                     // Критично
✅ ISR переменные                         // Критично
❌ НЕ ХРАНИТЕ большие массивы!
```

### 🐌 В PSRAM (медленно, много места):
```c
✅ uint8_t *big_buf = heap_caps_malloc(100KB, MALLOC_CAP_SPIRAM);
✅ LVGL графические буферы                // Некритично
✅ Кэши изображений                       // Некритично
✅ История данных (если большая)          // Некритично
```

### 📀 Во Flash (только чтение):
```c
✅ const char* TAG = "SENSOR";            // Строки
✅ const int pins[] = {1,2,3};            // Таблицы
✅ Код программы                          // Автоматически
✅ Шрифты и изображения                   // rodata
```

---

## 📈 Текущее использование (ПОСЛЕ оптимизации)

### DRAM:
```
[████████████████████░░░░░░░░] 67.5% использовано
 230 KB / 328 KB
 Свободно: 108 KB ✅ ХОРОШО
```

### PSRAM:
```
[█░░░░░░░░░░░░░░░░░░░░░░░░░░░] ~1% использовано
 ~100 KB / 2-8 MB
 Свободно: ~1.8-7.8 MB ✅ ОТЛИЧНО
```

### Flash:
```
[████████░░░░░░░░░░░░░░░░░░░░] 34% использовано
 1.32 MB / 3.83 MB
 Свободно: 2.6 MB ✅ ОТЛИЧНО
```

---

## 💡 Быстрые команды

### Проверка памяти:
```bash
idf.py size                    # Общая статистика
idf.py size-components         # По компонентам
```

### Если DRAM overflow:
```bash
# 1. Найти большие переменные
xtensa-esp32s3-elf-nm -S --size-sort build/hydroponics.elf | grep " b "

# 2. Перенести в PSRAM
# Замените: static uint8_t buf[BIG_SIZE];
# На: static uint8_t *buf = heap_caps_malloc(BIG_SIZE, MALLOC_CAP_SPIRAM);
```

---

## ⚠️ Главное правило

```
╔═══════════════════════════════════════════════════════╗
║  Маленькое (<1KB) + Критичное → DRAM                 ║
║  Большое (>1KB) + Некритичное → PSRAM                ║
║  Константы → Flash                                    ║
╚═══════════════════════════════════════════════════════╝
```

---

## 📚 Дополнительно

**Детальная информация:**
- `ПАМЯТЬ_ESP32S3_СПРАВКА.md` - полный справочник
- `АРХИТЕКТУРА_ПАМЯТИ_ESP32S3.md` - архитектура и примеры
- `ОПТИМИЗАЦИЯ_ПАМЯТИ_ОТЧЕТ.md` - отчет о проделанной работе

