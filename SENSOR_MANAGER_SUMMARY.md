# ‚≠ê SENSOR_MANAGER - –ö–†–ê–¢–ö–ê–Ø –°–í–û–î–ö–ê

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 16 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù –ò –ò–ù–¢–ï–ì–†–ò–†–û–í–ê–ù  
**–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** ~30 –º–∏–Ω—É—Ç  

---

## ‚úÖ –ß–¢–û –°–î–ï–õ–ê–ù–û

### 1. –°–æ–∑–¥–∞–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `sensor_manager`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:**
```
components/sensor_manager/
‚îú‚îÄ‚îÄ sensor_manager.h      (199 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ sensor_manager.c      (430 —Å—Ç—Ä–æ–∫)
‚îî‚îÄ‚îÄ CMakeLists.txt        (15 —Å—Ç—Ä–æ–∫)
```

---

### 2. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ —Å–∏—Å—Ç–µ–º—É

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ `main/app_main.c` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ `main/CMakeLists.txt` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
- ‚úÖ `components/system_tasks/system_tasks.c` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç sensor_manager
- ‚úÖ `components/system_tasks/CMakeLists.txt` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
- ‚úÖ `components/sensor_manager/*` - –Ω–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

---

### 3. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–±–æ—Ä–∫–∏

```
‚úÖ –°–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞!
‚úÖ –†–∞–∑–º–µ—Ä: 788 KB (25% —Å–≤–æ–±–æ–¥–Ω–æ)
‚úÖ –û—à–∏–±–æ–∫: 0
‚ö†Ô∏è  Warnings: —Ç–æ–ª—å–∫–æ unused variables (–Ω–µ–∫—Ä–∏—Ç–∏—á–Ω–æ)
‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ—à–∏–≤–∫–µ!
```

---

## üéØ –û–°–ù–û–í–ù–´–ï –í–û–ó–ú–û–ñ–ù–û–°–¢–ò

### ‚úÖ –§—É–Ω–∫—Ü–∏–∏:

1. **–ß—Ç–µ–Ω–∏–µ –¥–∞—Ç—á–∏–∫–æ–≤**
   - `sensor_manager_read_all()` - –≤—Å–µ –¥–∞—Ç—á–∏–∫–∏
   - `sensor_manager_read_ph()` - —Ç–æ–ª—å–∫–æ pH
   - `sensor_manager_read_ec()` - —Ç–æ–ª—å–∫–æ EC

2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - `sensor_manager_get_cached_data()` - –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø

3. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**
   - `sensor_manager_is_sensor_healthy()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
   - `sensor_manager_get_stats()` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

4. **–ö–∞–ª–∏–±—Ä–æ–≤–∫–∞**
   - `sensor_manager_calibrate_ph()` - –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ pH
   - `sensor_manager_calibrate_ec()` - –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ EC

---

## üí° –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê

| –î–æ | –ü–æ—Å–ª–µ |
|----|-------|
| –ü—Ä—è–º–æ–µ —á—Ç–µ–Ω–∏–µ `trema_ph_read()` | –ß–µ—Ä–µ–∑ –º–µ–Ω–µ–¥–∂–µ—Ä —Å retry |
| –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ | 3 –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ |
| –î—É–±–ª–∏—Ä—É—é—â–∏–µ I2C –∑–∞–ø—Ä–æ—Å—ã | –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö |
| –ù–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ | –ü–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
| –°–ª–æ–∂–Ω–∞—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ | API –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ |
| –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ |

---

## üìä –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï

### –ü—Ä–∏–º–µ—Ä 1: –ß—Ç–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞—Ç—á–∏–∫–æ–≤

```c
sensor_data_t data;
if (sensor_manager_read_all(&data) == ESP_OK) {
    if (data.valid[SENSOR_INDEX_PH]) {
        use_ph_value(data.ph);
    }
}
```

### –ü—Ä–∏–º–µ—Ä 2: –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∏–∑ UI

```c
sensor_data_t cached;
sensor_manager_get_cached_data(&cached);  // –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ!
lv_label_set_text_fmt(label, "%.1f¬∞C", cached.temperature);
```

### –ü—Ä–∏–º–µ—Ä 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è

```c
if (!sensor_manager_is_sensor_healthy(SENSOR_TYPE_PH)) {
    notification_system(NOTIFICATION_WARNING, 
                       "pH sensor has issues!", 
                       NOTIF_SOURCE_SENSOR);
}
```

---

## üîÑ –ü–û–¢–û–ö –î–ê–ù–ù–´–•

```
–î–∞—Ç—á–∏–∫–∏ ‚Üí sensor_manager ‚Üí system_tasks ‚Üí pid_controller ‚Üí pump_manager
                ‚Üì              ‚Üì              ‚Üì
             –∫—ç—à             –æ—á–µ—Ä–µ–¥—å        —ç–∫—Ä–∞–Ω—ã UI
```

---

## üìù –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –ú—å—é—Ç–µ–∫—Å:
- –ó–∞—â–∏—Ç–∞ –∫—ç—à–∞ –¥–∞–Ω–Ω—ã—Ö
- –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á

### Retry –ª–æ–≥–∏–∫–∞:
- 3 –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ
- 50–º—Å –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏

### –í–∞–ª–∏–¥–∞—Ü–∏—è:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ NaN
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ (pH: 0-14, EC: >0)

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á—Ç–µ–Ω–∏–π
- –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö
- –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—à–∏–±–∫–∏
- –§–ª–∞–≥ –∑–¥–æ—Ä–æ–≤—å—è (>80% —É—Å–ø–µ—Ö)

---

## üéì –î–õ–Ø AI-–ê–°–°–ò–°–¢–ï–ù–¢–û–í

### ‚ö†Ô∏è –í–ê–ñ–ù–û!

**–í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–π sensor_manager –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞—Ç—á–∏–∫–æ–≤!**

```c
// ‚ùå –ù–ï –î–ï–õ–ê–ô –¢–ê–ö:
float ph;
trema_ph_read(&ph);

// ‚úÖ –î–ï–õ–ê–ô –¢–ê–ö:
float ph;
sensor_manager_read_ph(&ph);

// ‚úÖ –ò–õ–ò –ï–©–Å –õ–£–ß–®–ï (–≤—Å–µ –¥–∞—Ç—á–∏–∫–∏):
sensor_data_t data;
sensor_manager_read_all(&data);
```

---

## ‚úÖ –ò–¢–û–ì

**sensor_manager —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –ø—Ä–æ–µ–∫—Ç Hydro 1.0!**

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å—Ç–∞–ª–∞:
- ‚úÖ –ë–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–π
- ‚úÖ –ë–æ–ª–µ–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–π
- ‚úÖ –ë–æ–ª–µ–µ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ–π
- ‚úÖ –ü—Ä–æ—â–µ –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏

**–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ—à–∏–≤–∫–µ!** üöÄ‚ú®


