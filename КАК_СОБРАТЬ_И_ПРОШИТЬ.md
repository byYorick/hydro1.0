# Инструкция по сборке и прошивке после исправления иконок

## Что было исправлено

✅ Добавлена поддержка иконок LVGL (символы LV_SYMBOL_*)
✅ Иконки больше не отображаются квадратами
✅ Сохранена поддержка кириллицы

## Сборка проекта

### 1. Очистите предыдущую сборку (рекомендуется)

```bash
idf.py fullclean
```

### 2. Соберите проект

```bash
idf.py build
```

### 3. Прошейте устройство

```bash
idf.py -p COM3 flash monitor
```

_(Замените COM3 на ваш порт)_

## Быстрая прошивка (если уже собирали)

```bash
idf.py -p COM3 flash
```

## Проверка работы

После прошивки проверьте:

### 1. Кнопка "Назад"
- Должна отображать стрелку: **◄**
- Если видите квадрат - иконки не работают

### 2. Меню
- Стрелки в меню: **►**
- Иконки настроек: **⚙**
- Иконки обновления: **⟳**

### 3. Попапы и уведомления
- Успех: **✓**
- Предупреждение: **⚠**
- Ошибка: **✕**

### 4. Текст на русском
- Все надписи должны быть на кириллице
- Без квадратиков или знаков вопроса

## Если иконки всё равно квадраты

### Вариант 1: Проверьте версию LVGL

Fallback шрифт работает только в LVGL 8.2+. Проверьте в логах:

```bash
idf.py monitor
```

Найдите строку:
```
Default font set to montserrat_ru with fallback for icons
```

### Вариант 2: Пересоздайте шрифт с иконками

См. инструкцию в `main/README_FONT_ICONS.md`

Нужно добавить диапазон Unicode для иконок:
```
0xF000-0xF8FF
```

### Вариант 3: Проверьте lv_conf.h

Убедитесь, что включен встроенный шрифт:

```c
#define LV_FONT_MONTSERRAT_14 1
```

## Отладка

### Просмотр логов

```bash
idf.py monitor
```

Ищите строки:
- `UI styles initialized` - стили инициализированы
- `Default font set to montserrat_ru` - шрифт установлен
- Любые ERROR или WARNING связанные с шрифтами

### Увеличение уровня логирования

В `sdkconfig`:
```
CONFIG_LOG_DEFAULT_LEVEL_DEBUG=y
```

### Проверка памяти

Если устройство перезагружается:
```bash
idf.py monitor
```

Проверьте строки с `Stack overflow` или `Out of memory`

## Полезные команды

```bash
# Только сборка
idf.py build

# Только прошивка (без сборки)
idf.py -p COM3 flash

# Прошивка + мониторинг
idf.py -p COM3 flash monitor

# Только мониторинг
idf.py -p COM3 monitor

# Очистка сборки
idf.py fullclean

# Конфигурация проекта
idf.py menuconfig
```

## Структура измененных файлов

```
hydro1.0/
├── main/
│   ├── montserrat14_ru.c          # ✅ Добавлен fallback
│   └── README_FONT_ICONS.md       # ℹ️ Инструкция по шрифтам
├── components/lvgl_ui/
│   ├── lvgl_ui.c                  # ✅ Установлена тема с шрифтом
│   ├── widgets/
│   │   ├── back_button.c          # ✅ Иконка "◄"
│   │   └── menu_list.c            # ✅ Иконки "►"
│   └── screens/
│       └── popup_screen.c         # ✅ Иконки попапов
├── ИКОНКИ_ИСПРАВЛЕНО.md           # ℹ️ Описание исправлений
└── КАК_СОБРАТЬ_И_ПРОШИТЬ.md       # ℹ️ Эта инструкция
```

## Контрольный список

- [ ] Выполнена очистка: `idf.py fullclean`
- [ ] Выполнена сборка: `idf.py build`
- [ ] Прошивка успешна: `idf.py -p COM3 flash`
- [ ] Кнопка "Назад" показывает стрелку ◄
- [ ] Меню показывает стрелки ►
- [ ] Попапы показывают иконки ✓⚠✕
- [ ] Текст на русском отображается корректно
- [ ] Нет ошибок в логах

## Поддержка

Если возникли проблемы:
1. Проверьте логи: `idf.py monitor`
2. Очистите и пересоберите: `idf.py fullclean && idf.py build`
3. Проверьте версию LVGL
4. См. `main/README_FONT_ICONS.md` для альтернативных решений

